<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=prev href=pipeline.html><link rel=next href=render_setup_tools.html><link rel=icon href=../../../../img/favicon.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.9"><title>plugin - ayon-maya</title><link rel=stylesheet href=../../../../assets/stylesheets/main.4af4bdda.min.css><link rel=stylesheet href=../../../../assets/stylesheets/palette.06af60db.min.css><script src=https://unpkg.com/iframe-worker/shim></script><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../../assets/_mkdocstrings.css><link rel=stylesheet href=../../../../css/custom.css><script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#client.ayon_maya.api.plugin class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../../index.html title=ayon-maya class="md-header__button md-logo" aria-label=ayon-maya data-md-component=logo> <img src=../../../../img/ay-symbol-blackw-full.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> ayon-maya </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> plugin </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ynput/ayon-maya title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../../index.html title=ayon-maya class="md-nav__button md-logo" aria-label=ayon-maya data-md-component=logo> <img src=../../../../img/ay-symbol-blackw-full.png alt=logo> </a> ayon-maya </label> <div class=md-nav__source> <a href=https://github.com/ynput/ayon-maya title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../index.html class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../../../license.html class=md-nav__link> <span class=md-ellipsis> License </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1 checked> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> <span class=md-ellipsis> client </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=true> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> client </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1_1 checked> <div class="md-nav__link md-nav__container"> <a href=../index.html class="md-nav__link "> <span class=md-ellipsis> ayon_maya </span> </a> <label class="md-nav__link " for=__nav_3_1_1 id=__nav_3_1_1_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_1_1_label aria-expanded=true> <label class=md-nav__title for=__nav_3_1_1> <span class="md-nav__icon md-icon"></span> ayon_maya </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../addon.html class=md-nav__link> <span class=md-ellipsis> addon </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1_1_2 checked> <div class="md-nav__link md-nav__container"> <a href=index.html class="md-nav__link "> <span class=md-ellipsis> api </span> </a> <label class="md-nav__link " for=__nav_3_1_1_2 id=__nav_3_1_1_2_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_1_1_2_label aria-expanded=true> <label class=md-nav__title for=__nav_3_1_1_2> <span class="md-nav__icon md-icon"></span> api </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=action.html class=md-nav__link> <span class=md-ellipsis> action </span> </a> </li> <li class=md-nav__item> <a href=alembic.html class=md-nav__link> <span class=md-ellipsis> alembic </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=chasers/export_filter_properties.html class=md-nav__link> <span class=md-ellipsis> chasers </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=commands.html class=md-nav__link> <span class=md-ellipsis> commands </span> </a> </li> <li class=md-nav__item> <a href=customize.html class=md-nav__link> <span class=md-ellipsis> customize </span> </a> </li> <li class=md-nav__item> <a href=fbx.html class=md-nav__link> <span class=md-ellipsis> fbx </span> </a> </li> <li class=md-nav__item> <a href=gltf.html class=md-nav__link> <span class=md-ellipsis> gltf </span> </a> </li> <li class=md-nav__item> <a href=lib.html class=md-nav__link> <span class=md-ellipsis> lib </span> </a> </li> <li class=md-nav__item> <a href=lib_renderproducts.html class=md-nav__link> <span class=md-ellipsis> lib_renderproducts </span> </a> </li> <li class=md-nav__item> <a href=lib_rendersettings.html class=md-nav__link> <span class=md-ellipsis> lib_rendersettings </span> </a> </li> <li class=md-nav__item> <a href=lib_rendersetup.html class=md-nav__link> <span class=md-ellipsis> lib_rendersetup </span> </a> </li> <li class=md-nav__item> <a href=menu.html class=md-nav__link> <span class=md-ellipsis> menu </span> </a> </li> <li class=md-nav__item> <a href=pipeline.html class=md-nav__link> <span class=md-ellipsis> pipeline </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> plugin </span> <span class="md-nav__icon md-icon"></span> </label> <a href=plugin.html class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> plugin </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin class=md-nav__link> <span class=md-ellipsis> plugin </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.Loader class=md-nav__link> <span class=md-ellipsis> Loader </span> </a> <nav class=md-nav aria-label=Loader> <ul class=md-nav__list> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.Loader.get_custom_namespace_and_group class=md-nav__link> <span class=md-ellipsis> get_custom_namespace_and_group </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.MayaAutoCreator class=md-nav__link> <span class=md-ellipsis> MayaAutoCreator </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.MayaContextPlugin class=md-nav__link> <span class=md-ellipsis> MayaContextPlugin </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.MayaCreatorBase class=md-nav__link> <span class=md-ellipsis> MayaCreatorBase </span> </a> <nav class=md-nav aria-label=MayaCreatorBase> <ul class=md-nav__list> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.MayaCreatorBase.cache_instance_data class=md-nav__link> <span class=md-ellipsis> cache_instance_data </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.MayaCreatorBase.get_publish_families class=md-nav__link> <span class=md-ellipsis> get_publish_families </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.MayaExtractorPlugin class=md-nav__link> <span class=md-ellipsis> MayaExtractorPlugin </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.MayaHiddenCreator class=md-nav__link> <span class=md-ellipsis> MayaHiddenCreator </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.MayaInstancePlugin class=md-nav__link> <span class=md-ellipsis> MayaInstancePlugin </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.MayaLoader class=md-nav__link> <span class=md-ellipsis> MayaLoader </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.ReferenceLoader class=md-nav__link> <span class=md-ellipsis> ReferenceLoader </span> </a> <nav class=md-nav aria-label=ReferenceLoader> <ul class=md-nav__list> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.ReferenceLoader.prepare_root_value class=md-nav__link> <span class=md-ellipsis> prepare_root_value </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.ReferenceLoader.process_reference class=md-nav__link> <span class=md-ellipsis> process_reference </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.ReferenceLoader.remove class=md-nav__link> <span class=md-ellipsis> remove </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.RenderlayerCreator class=md-nav__link> <span class=md-ellipsis> RenderlayerCreator </span> </a> <nav class=md-nav aria-label=RenderlayerCreator> <ul class=md-nav__list> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.RenderlayerCreator.remove_instances class=md-nav__link> <span class=md-ellipsis> remove_instances </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.ensure_namespace class=md-nav__link> <span class=md-ellipsis> ensure_namespace </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.get_ayon_entity_uri_from_representation_context class=md-nav__link> <span class=md-ellipsis> get_ayon_entity_uri_from_representation_context </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.get_load_color_for_product_type class=md-nav__link> <span class=md-ellipsis> get_load_color_for_product_type </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.get_reference_node class=md-nav__link> <span class=md-ellipsis> get_reference_node </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.get_reference_node_parents class=md-nav__link> <span class=md-ellipsis> get_reference_node_parents </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=render_setup_tools.html class=md-nav__link> <span class=md-ellipsis> render_setup_tools </span> </a> </li> <li class=md-nav__item> <a href=setdress.html class=md-nav__link> <span class=md-ellipsis> setdress </span> </a> </li> <li class=md-nav__item> <a href=workfile_template_builder.html class=md-nav__link> <span class=md-ellipsis> workfile_template_builder </span> </a> </li> <li class=md-nav__item> <a href=workio.html class=md-nav__link> <span class=md-ellipsis> workio </span> </a> </li> <li class=md-nav__item> <a href=yeti.html class=md-nav__link> <span class=md-ellipsis> yeti </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../hooks/pre_auto_load_plugins.html class=md-nav__link> <span class=md-ellipsis> hooks </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../lib.html class=md-nav__link> <span class=md-ellipsis> lib </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../plugins/create/convert_legacy.html class=md-nav__link> <span class=md-ellipsis> plugins </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../startup/userSetup.html class=md-nav__link> <span class=md-ellipsis> startup </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../tools/mayalookassigner/alembic.html class=md-nav__link> <span class=md-ellipsis> tools </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../vendor/python/capture.html class=md-nav__link> <span class=md-ellipsis> vendor </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../version.html class=md-nav__link> <span class=md-ellipsis> version </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../server/settings/conversion.html class=md-nav__link> <span class=md-ellipsis> server </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin class=md-nav__link> <span class=md-ellipsis> plugin </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.Loader class=md-nav__link> <span class=md-ellipsis> Loader </span> </a> <nav class=md-nav aria-label=Loader> <ul class=md-nav__list> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.Loader.get_custom_namespace_and_group class=md-nav__link> <span class=md-ellipsis> get_custom_namespace_and_group </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.MayaAutoCreator class=md-nav__link> <span class=md-ellipsis> MayaAutoCreator </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.MayaContextPlugin class=md-nav__link> <span class=md-ellipsis> MayaContextPlugin </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.MayaCreatorBase class=md-nav__link> <span class=md-ellipsis> MayaCreatorBase </span> </a> <nav class=md-nav aria-label=MayaCreatorBase> <ul class=md-nav__list> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.MayaCreatorBase.cache_instance_data class=md-nav__link> <span class=md-ellipsis> cache_instance_data </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.MayaCreatorBase.get_publish_families class=md-nav__link> <span class=md-ellipsis> get_publish_families </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.MayaExtractorPlugin class=md-nav__link> <span class=md-ellipsis> MayaExtractorPlugin </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.MayaHiddenCreator class=md-nav__link> <span class=md-ellipsis> MayaHiddenCreator </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.MayaInstancePlugin class=md-nav__link> <span class=md-ellipsis> MayaInstancePlugin </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.MayaLoader class=md-nav__link> <span class=md-ellipsis> MayaLoader </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.ReferenceLoader class=md-nav__link> <span class=md-ellipsis> ReferenceLoader </span> </a> <nav class=md-nav aria-label=ReferenceLoader> <ul class=md-nav__list> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.ReferenceLoader.prepare_root_value class=md-nav__link> <span class=md-ellipsis> prepare_root_value </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.ReferenceLoader.process_reference class=md-nav__link> <span class=md-ellipsis> process_reference </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.ReferenceLoader.remove class=md-nav__link> <span class=md-ellipsis> remove </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.RenderlayerCreator class=md-nav__link> <span class=md-ellipsis> RenderlayerCreator </span> </a> <nav class=md-nav aria-label=RenderlayerCreator> <ul class=md-nav__list> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.RenderlayerCreator.remove_instances class=md-nav__link> <span class=md-ellipsis> remove_instances </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.ensure_namespace class=md-nav__link> <span class=md-ellipsis> ensure_namespace </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.get_ayon_entity_uri_from_representation_context class=md-nav__link> <span class=md-ellipsis> get_ayon_entity_uri_from_representation_context </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.get_load_color_for_product_type class=md-nav__link> <span class=md-ellipsis> get_load_color_for_product_type </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.get_reference_node class=md-nav__link> <span class=md-ellipsis> get_reference_node </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_maya.api.plugin.get_reference_node_parents class=md-nav__link> <span class=md-ellipsis> get_reference_node_parents </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>plugin</h1> <div class="doc doc-object doc-module"> <a id=client.ayon_maya.api.plugin></a> <div class="doc doc-contents first"> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h2 id=client.ayon_maya.api.plugin.Loader class="doc doc-heading"> <code>Loader</code> </h2> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=ayon_core.pipeline.LoaderPlugin>LoaderPlugin</span></code></p> <details class=quote> <summary>Source code in <code>client/ayon_maya/api/plugin.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>670</span>
<span class=normal>671</span>
<span class=normal>672</span>
<span class=normal>673</span>
<span class=normal>674</span>
<span class=normal>675</span>
<span class=normal>676</span>
<span class=normal>677</span>
<span class=normal>678</span>
<span class=normal>679</span>
<span class=normal>680</span>
<span class=normal>681</span>
<span class=normal>682</span>
<span class=normal>683</span>
<span class=normal>684</span>
<span class=normal>685</span>
<span class=normal>686</span>
<span class=normal>687</span>
<span class=normal>688</span>
<span class=normal>689</span>
<span class=normal>690</span>
<span class=normal>691</span>
<span class=normal>692</span>
<span class=normal>693</span>
<span class=normal>694</span>
<span class=normal>695</span>
<span class=normal>696</span>
<span class=normal>697</span>
<span class=normal>698</span>
<span class=normal>699</span>
<span class=normal>700</span>
<span class=normal>701</span>
<span class=normal>702</span>
<span class=normal>703</span>
<span class=normal>704</span>
<span class=normal>705</span>
<span class=normal>706</span>
<span class=normal>707</span>
<span class=normal>708</span>
<span class=normal>709</span>
<span class=normal>710</span>
<span class=normal>711</span>
<span class=normal>712</span>
<span class=normal>713</span>
<span class=normal>714</span>
<span class=normal>715</span>
<span class=normal>716</span>
<span class=normal>717</span>
<span class=normal>718</span>
<span class=normal>719</span>
<span class=normal>720</span>
<span class=normal>721</span>
<span class=normal>722</span>
<span class=normal>723</span>
<span class=normal>724</span>
<span class=normal>725</span>
<span class=normal>726</span>
<span class=normal>727</span>
<span class=normal>728</span>
<span class=normal>729</span>
<span class=normal>730</span>
<span class=normal>731</span>
<span class=normal>732</span>
<span class=normal>733</span>
<span class=normal>734</span>
<span class=normal>735</span>
<span class=normal>736</span>
<span class=normal>737</span>
<span class=normal>738</span>
<span class=normal>739</span>
<span class=normal>740</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>Loader</span><span class=p>(</span><span class=n>LoaderPlugin</span><span class=p>):</span>
    <span class=n>hosts</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;maya&quot;</span><span class=p>]</span>
    <span class=n>settings_category</span> <span class=o>=</span> <span class=n>SETTINGS_CATEGORY</span>
    <span class=n>load_settings</span> <span class=o>=</span> <span class=p>{}</span>  <span class=c1># defined in settings</span>

    <span class=n>use_ayon_entity_uri</span> <span class=o>=</span> <span class=kc>False</span>

    <span class=nd>@classmethod</span>
    <span class=k>def</span><span class=w> </span><span class=nf>filepath_from_context</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>context</span><span class=p>):</span>
        <span class=c1># TODO: This is a 1:1 copy from ayon-houdini and may be good to</span>
        <span class=c1>#  refactor and de-duplicate across the codebase, e.g. to core</span>
        <span class=k>if</span> <span class=bp>cls</span><span class=o>.</span><span class=n>use_ayon_entity_uri</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>get_ayon_entity_uri_from_representation_context</span><span class=p>(</span><span class=n>context</span><span class=p>)</span>

        <span class=k>return</span> <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=n>filepath_from_context</span><span class=p>(</span><span class=n>context</span><span class=p>)</span>

    <span class=nd>@classmethod</span>
    <span class=k>def</span><span class=w> </span><span class=nf>apply_settings</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>project_settings</span><span class=p>):</span>
        <span class=nb>super</span><span class=p>(</span><span class=n>Loader</span><span class=p>,</span> <span class=bp>cls</span><span class=p>)</span><span class=o>.</span><span class=n>apply_settings</span><span class=p>(</span><span class=n>project_settings</span><span class=p>)</span>
        <span class=bp>cls</span><span class=o>.</span><span class=n>load_settings</span> <span class=o>=</span> <span class=n>project_settings</span><span class=p>[</span><span class=s1>&#39;maya&#39;</span><span class=p>][</span><span class=s1>&#39;load&#39;</span><span class=p>]</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_custom_namespace_and_group</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>context</span><span class=p>,</span> <span class=n>options</span><span class=p>,</span> <span class=n>loader_key</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Queries Settings to get custom template for namespace and group.</span>

<span class=sd>        Group template might be empty &gt;&gt; this forces to not wrap imported items</span>
<span class=sd>        into separate group.</span>

<span class=sd>        Args:</span>
<span class=sd>            context (dict)</span>
<span class=sd>            options (dict): artist modifiable options from dialog</span>
<span class=sd>            loader_key (str): key to get separate configuration from Settings</span>
<span class=sd>                (&#39;reference_loader&#39;|&#39;import_loader&#39;)</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=n>options</span><span class=p>[</span><span class=s2>&quot;attach_to_root&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
        <span class=n>custom_naming</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>load_settings</span><span class=p>[</span><span class=n>loader_key</span><span class=p>]</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=n>custom_naming</span><span class=p>[</span><span class=s2>&quot;namespace&quot;</span><span class=p>]:</span>
            <span class=k>raise</span> <span class=n>LoadError</span><span class=p>(</span><span class=s2>&quot;No namespace specified in &quot;</span>
                            <span class=s2>&quot;Maya ReferenceLoader settings&quot;</span><span class=p>)</span>
        <span class=k>elif</span> <span class=ow>not</span> <span class=n>custom_naming</span><span class=p>[</span><span class=s2>&quot;group_name&quot;</span><span class=p>]:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;No custom group_name, no group will be created.&quot;</span><span class=p>)</span>
            <span class=n>options</span><span class=p>[</span><span class=s2>&quot;attach_to_root&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=kc>False</span>

        <span class=n>folder_entity</span> <span class=o>=</span> <span class=n>context</span><span class=p>[</span><span class=s2>&quot;folder&quot;</span><span class=p>]</span>
        <span class=n>product_entity</span> <span class=o>=</span> <span class=n>context</span><span class=p>[</span><span class=s2>&quot;product&quot;</span><span class=p>]</span>
        <span class=n>product_name</span> <span class=o>=</span> <span class=n>product_entity</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]</span>
        <span class=n>product_type</span> <span class=o>=</span> <span class=n>product_entity</span><span class=p>[</span><span class=s2>&quot;productType&quot;</span><span class=p>]</span>
        <span class=n>formatting_data</span> <span class=o>=</span> <span class=p>{</span>
            <span class=s2>&quot;asset_name&quot;</span><span class=p>:</span> <span class=n>folder_entity</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>],</span>
            <span class=s2>&quot;asset_type&quot;</span><span class=p>:</span> <span class=s2>&quot;asset&quot;</span><span class=p>,</span>
            <span class=s2>&quot;folder&quot;</span><span class=p>:</span> <span class=p>{</span>
                <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>folder_entity</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>],</span>
            <span class=p>},</span>
            <span class=s2>&quot;subset&quot;</span><span class=p>:</span> <span class=n>product_name</span><span class=p>,</span>
            <span class=s2>&quot;product&quot;</span><span class=p>:</span> <span class=p>{</span>
                <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>product_name</span><span class=p>,</span>
                <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=n>product_type</span><span class=p>,</span>
            <span class=p>},</span>
            <span class=s2>&quot;family&quot;</span><span class=p>:</span> <span class=n>product_type</span>
        <span class=p>}</span>

        <span class=n>custom_namespace</span> <span class=o>=</span> <span class=n>custom_naming</span><span class=p>[</span><span class=s2>&quot;namespace&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=o>**</span><span class=n>formatting_data</span>
        <span class=p>)</span>

        <span class=n>custom_group_name</span> <span class=o>=</span> <span class=n>custom_naming</span><span class=p>[</span><span class=s2>&quot;group_name&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=o>**</span><span class=n>formatting_data</span>
        <span class=p>)</span>

        <span class=k>return</span> <span class=n>custom_group_name</span><span class=p>,</span> <span class=n>custom_namespace</span><span class=p>,</span> <span class=n>options</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h3 id=client.ayon_maya.api.plugin.Loader.get_custom_namespace_and_group class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_custom_namespace_and_group</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>options</span><span class=p>,</span> <span class=n>loader_key</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Queries Settings to get custom template for namespace and group.</p> <p>Group template might be empty &gt;&gt; this forces to not wrap imported items into separate group.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>options</code> </td> <td> <code><span title=dict>dict</span></code> </td> <td> <div class=doc-md-description> <p>artist modifiable options from dialog</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>loader_key</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>key to get separate configuration from Settings ('reference_loader'|'import_loader')</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_maya/api/plugin.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>691</span>
<span class=normal>692</span>
<span class=normal>693</span>
<span class=normal>694</span>
<span class=normal>695</span>
<span class=normal>696</span>
<span class=normal>697</span>
<span class=normal>698</span>
<span class=normal>699</span>
<span class=normal>700</span>
<span class=normal>701</span>
<span class=normal>702</span>
<span class=normal>703</span>
<span class=normal>704</span>
<span class=normal>705</span>
<span class=normal>706</span>
<span class=normal>707</span>
<span class=normal>708</span>
<span class=normal>709</span>
<span class=normal>710</span>
<span class=normal>711</span>
<span class=normal>712</span>
<span class=normal>713</span>
<span class=normal>714</span>
<span class=normal>715</span>
<span class=normal>716</span>
<span class=normal>717</span>
<span class=normal>718</span>
<span class=normal>719</span>
<span class=normal>720</span>
<span class=normal>721</span>
<span class=normal>722</span>
<span class=normal>723</span>
<span class=normal>724</span>
<span class=normal>725</span>
<span class=normal>726</span>
<span class=normal>727</span>
<span class=normal>728</span>
<span class=normal>729</span>
<span class=normal>730</span>
<span class=normal>731</span>
<span class=normal>732</span>
<span class=normal>733</span>
<span class=normal>734</span>
<span class=normal>735</span>
<span class=normal>736</span>
<span class=normal>737</span>
<span class=normal>738</span>
<span class=normal>739</span>
<span class=normal>740</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_custom_namespace_and_group</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>context</span><span class=p>,</span> <span class=n>options</span><span class=p>,</span> <span class=n>loader_key</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Queries Settings to get custom template for namespace and group.</span>

<span class=sd>    Group template might be empty &gt;&gt; this forces to not wrap imported items</span>
<span class=sd>    into separate group.</span>

<span class=sd>    Args:</span>
<span class=sd>        context (dict)</span>
<span class=sd>        options (dict): artist modifiable options from dialog</span>
<span class=sd>        loader_key (str): key to get separate configuration from Settings</span>
<span class=sd>            (&#39;reference_loader&#39;|&#39;import_loader&#39;)</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>options</span><span class=p>[</span><span class=s2>&quot;attach_to_root&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
    <span class=n>custom_naming</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>load_settings</span><span class=p>[</span><span class=n>loader_key</span><span class=p>]</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>custom_naming</span><span class=p>[</span><span class=s2>&quot;namespace&quot;</span><span class=p>]:</span>
        <span class=k>raise</span> <span class=n>LoadError</span><span class=p>(</span><span class=s2>&quot;No namespace specified in &quot;</span>
                        <span class=s2>&quot;Maya ReferenceLoader settings&quot;</span><span class=p>)</span>
    <span class=k>elif</span> <span class=ow>not</span> <span class=n>custom_naming</span><span class=p>[</span><span class=s2>&quot;group_name&quot;</span><span class=p>]:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;No custom group_name, no group will be created.&quot;</span><span class=p>)</span>
        <span class=n>options</span><span class=p>[</span><span class=s2>&quot;attach_to_root&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=kc>False</span>

    <span class=n>folder_entity</span> <span class=o>=</span> <span class=n>context</span><span class=p>[</span><span class=s2>&quot;folder&quot;</span><span class=p>]</span>
    <span class=n>product_entity</span> <span class=o>=</span> <span class=n>context</span><span class=p>[</span><span class=s2>&quot;product&quot;</span><span class=p>]</span>
    <span class=n>product_name</span> <span class=o>=</span> <span class=n>product_entity</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]</span>
    <span class=n>product_type</span> <span class=o>=</span> <span class=n>product_entity</span><span class=p>[</span><span class=s2>&quot;productType&quot;</span><span class=p>]</span>
    <span class=n>formatting_data</span> <span class=o>=</span> <span class=p>{</span>
        <span class=s2>&quot;asset_name&quot;</span><span class=p>:</span> <span class=n>folder_entity</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>],</span>
        <span class=s2>&quot;asset_type&quot;</span><span class=p>:</span> <span class=s2>&quot;asset&quot;</span><span class=p>,</span>
        <span class=s2>&quot;folder&quot;</span><span class=p>:</span> <span class=p>{</span>
            <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>folder_entity</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>],</span>
        <span class=p>},</span>
        <span class=s2>&quot;subset&quot;</span><span class=p>:</span> <span class=n>product_name</span><span class=p>,</span>
        <span class=s2>&quot;product&quot;</span><span class=p>:</span> <span class=p>{</span>
            <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>product_name</span><span class=p>,</span>
            <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=n>product_type</span><span class=p>,</span>
        <span class=p>},</span>
        <span class=s2>&quot;family&quot;</span><span class=p>:</span> <span class=n>product_type</span>
    <span class=p>}</span>

    <span class=n>custom_namespace</span> <span class=o>=</span> <span class=n>custom_naming</span><span class=p>[</span><span class=s2>&quot;namespace&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
        <span class=o>**</span><span class=n>formatting_data</span>
    <span class=p>)</span>

    <span class=n>custom_group_name</span> <span class=o>=</span> <span class=n>custom_naming</span><span class=p>[</span><span class=s2>&quot;group_name&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
        <span class=o>**</span><span class=n>formatting_data</span>
    <span class=p>)</span>

    <span class=k>return</span> <span class=n>custom_group_name</span><span class=p>,</span> <span class=n>custom_namespace</span><span class=p>,</span> <span class=n>options</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h2 id=client.ayon_maya.api.plugin.MayaAutoCreator class="doc doc-heading"> <code>MayaAutoCreator</code> </h2> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=ayon_core.pipeline.AutoCreator>AutoCreator</span></code>, <code><a class="autorefs autorefs-internal" title="MayaCreatorBase (client.ayon_maya.api.plugin.MayaCreatorBase)" href=#client.ayon_maya.api.plugin.MayaCreatorBase>MayaCreatorBase</a></code></p> <p>Automatically triggered creator for Maya.</p> <p>The plugin is not visible in UI, and 'create' method does not expect any arguments.</p> <details class=quote> <summary>Source code in <code>client/ayon_maya/api/plugin.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>346</span>
<span class=normal>347</span>
<span class=normal>348</span>
<span class=normal>349</span>
<span class=normal>350</span>
<span class=normal>351</span>
<span class=normal>352</span>
<span class=normal>353</span>
<span class=normal>354</span>
<span class=normal>355</span>
<span class=normal>356</span>
<span class=normal>357</span>
<span class=normal>358</span>
<span class=normal>359</span>
<span class=normal>360</span>
<span class=normal>361</span>
<span class=normal>362</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>MayaAutoCreator</span><span class=p>(</span><span class=n>AutoCreator</span><span class=p>,</span> <span class=n>MayaCreatorBase</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Automatically triggered creator for Maya.</span>

<span class=sd>    The plugin is not visible in UI, and &#39;create&#39; method does not expect</span>
<span class=sd>        any arguments.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>settings_category</span> <span class=o>=</span> <span class=s2>&quot;maya&quot;</span>

    <span class=k>def</span><span class=w> </span><span class=nf>collect_instances</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_default_collect_instances</span><span class=p>()</span>

    <span class=k>def</span><span class=w> </span><span class=nf>update_instances</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>update_list</span><span class=p>):</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_default_update_instances</span><span class=p>(</span><span class=n>update_list</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>remove_instances</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>instances</span><span class=p>):</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_default_remove_instances</span><span class=p>(</span><span class=n>instances</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h2 id=client.ayon_maya.api.plugin.MayaContextPlugin class="doc doc-heading"> <code>MayaContextPlugin</code> </h2> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=pyblish.api.ContextPlugin>ContextPlugin</span></code></p> <p>Base class for context publish plugins.</p> <details class=quote> <summary>Source code in <code>client/ayon_maya/api/plugin.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1082</span>
<span class=normal>1083</span>
<span class=normal>1084</span>
<span class=normal>1085</span>
<span class=normal>1086</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>MayaContextPlugin</span><span class=p>(</span><span class=n>ContextPlugin</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Base class for context publish plugins.&quot;&quot;&quot;</span>

    <span class=n>settings_category</span> <span class=o>=</span> <span class=n>SETTINGS_CATEGORY</span>
    <span class=n>hosts</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;maya&quot;</span><span class=p>]</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h2 id=client.ayon_maya.api.plugin.MayaCreatorBase class="doc doc-heading"> <code>MayaCreatorBase</code> </h2> <div class="doc doc-contents "> <details class=quote> <summary>Source code in <code>client/ayon_maya/api/plugin.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span>
<span class=normal>155</span>
<span class=normal>156</span>
<span class=normal>157</span>
<span class=normal>158</span>
<span class=normal>159</span>
<span class=normal>160</span>
<span class=normal>161</span>
<span class=normal>162</span>
<span class=normal>163</span>
<span class=normal>164</span>
<span class=normal>165</span>
<span class=normal>166</span>
<span class=normal>167</span>
<span class=normal>168</span>
<span class=normal>169</span>
<span class=normal>170</span>
<span class=normal>171</span>
<span class=normal>172</span>
<span class=normal>173</span>
<span class=normal>174</span>
<span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span>
<span class=normal>178</span>
<span class=normal>179</span>
<span class=normal>180</span>
<span class=normal>181</span>
<span class=normal>182</span>
<span class=normal>183</span>
<span class=normal>184</span>
<span class=normal>185</span>
<span class=normal>186</span>
<span class=normal>187</span>
<span class=normal>188</span>
<span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span>
<span class=normal>192</span>
<span class=normal>193</span>
<span class=normal>194</span>
<span class=normal>195</span>
<span class=normal>196</span>
<span class=normal>197</span>
<span class=normal>198</span>
<span class=normal>199</span>
<span class=normal>200</span>
<span class=normal>201</span>
<span class=normal>202</span>
<span class=normal>203</span>
<span class=normal>204</span>
<span class=normal>205</span>
<span class=normal>206</span>
<span class=normal>207</span>
<span class=normal>208</span>
<span class=normal>209</span>
<span class=normal>210</span>
<span class=normal>211</span>
<span class=normal>212</span>
<span class=normal>213</span>
<span class=normal>214</span>
<span class=normal>215</span>
<span class=normal>216</span>
<span class=normal>217</span>
<span class=normal>218</span>
<span class=normal>219</span>
<span class=normal>220</span>
<span class=normal>221</span>
<span class=normal>222</span>
<span class=normal>223</span>
<span class=normal>224</span>
<span class=normal>225</span>
<span class=normal>226</span>
<span class=normal>227</span>
<span class=normal>228</span>
<span class=normal>229</span>
<span class=normal>230</span>
<span class=normal>231</span>
<span class=normal>232</span>
<span class=normal>233</span>
<span class=normal>234</span>
<span class=normal>235</span>
<span class=normal>236</span>
<span class=normal>237</span>
<span class=normal>238</span>
<span class=normal>239</span>
<span class=normal>240</span>
<span class=normal>241</span>
<span class=normal>242</span>
<span class=normal>243</span>
<span class=normal>244</span>
<span class=normal>245</span>
<span class=normal>246</span>
<span class=normal>247</span>
<span class=normal>248</span>
<span class=normal>249</span>
<span class=normal>250</span>
<span class=normal>251</span>
<span class=normal>252</span>
<span class=normal>253</span>
<span class=normal>254</span>
<span class=normal>255</span>
<span class=normal>256</span>
<span class=normal>257</span>
<span class=normal>258</span>
<span class=normal>259</span>
<span class=normal>260</span>
<span class=normal>261</span>
<span class=normal>262</span>
<span class=normal>263</span>
<span class=normal>264</span>
<span class=normal>265</span>
<span class=normal>266</span>
<span class=normal>267</span>
<span class=normal>268</span>
<span class=normal>269</span>
<span class=normal>270</span>
<span class=normal>271</span>
<span class=normal>272</span>
<span class=normal>273</span>
<span class=normal>274</span>
<span class=normal>275</span>
<span class=normal>276</span>
<span class=normal>277</span>
<span class=normal>278</span>
<span class=normal>279</span>
<span class=normal>280</span>
<span class=normal>281</span>
<span class=normal>282</span>
<span class=normal>283</span>
<span class=normal>284</span>
<span class=normal>285</span>
<span class=normal>286</span>
<span class=normal>287</span>
<span class=normal>288</span>
<span class=normal>289</span>
<span class=normal>290</span>
<span class=normal>291</span>
<span class=normal>292</span>
<span class=normal>293</span>
<span class=normal>294</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>MayaCreatorBase</span><span class=p>:</span>
    <span class=nd>@staticmethod</span>
    <span class=k>def</span><span class=w> </span><span class=nf>cache_instance_data</span><span class=p>(</span><span class=n>shared_data</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Cache instances for Creators to shared data.</span>

<span class=sd>        Create `maya_cached_instance_data` key when needed in shared data and</span>
<span class=sd>        fill it with all collected instances from the scene under its</span>
<span class=sd>        respective creator identifiers.</span>

<span class=sd>        If legacy instances are detected in the scene, create</span>
<span class=sd>        `maya_cached_legacy_instances` there and fill it with</span>
<span class=sd>        all legacy products under product type as a key.</span>

<span class=sd>        Args:</span>
<span class=sd>            Dict[str, Any]: Shared data.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=n>shared_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;maya_cached_instance_data&quot;</span><span class=p>)</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>cache</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>()</span>
            <span class=n>cache_legacy</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>()</span>

            <span class=k>for</span> <span class=n>node</span> <span class=ow>in</span> <span class=n>cmds</span><span class=o>.</span><span class=n>ls</span><span class=p>(</span><span class=nb>type</span><span class=o>=</span><span class=s2>&quot;objectSet&quot;</span><span class=p>):</span>

                <span class=k>if</span> <span class=n>_get_attr</span><span class=p>(</span><span class=n>node</span><span class=p>,</span> <span class=n>attr</span><span class=o>=</span><span class=s2>&quot;id&quot;</span><span class=p>)</span> <span class=ow>not</span> <span class=ow>in</span> <span class=p>{</span>
                    <span class=n>AYON_INSTANCE_ID</span><span class=p>,</span> <span class=n>AVALON_INSTANCE_ID</span>
                <span class=p>}:</span>
                    <span class=k>continue</span>

                <span class=n>creator_id</span> <span class=o>=</span> <span class=n>_get_attr</span><span class=p>(</span><span class=n>node</span><span class=p>,</span> <span class=n>attr</span><span class=o>=</span><span class=s2>&quot;creator_identifier&quot;</span><span class=p>)</span>
                <span class=k>if</span> <span class=n>creator_id</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
                    <span class=c1># creator instance</span>
                    <span class=n>cache</span><span class=o>.</span><span class=n>setdefault</span><span class=p>(</span><span class=n>creator_id</span><span class=p>,</span> <span class=p>[])</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>
                <span class=k>else</span><span class=p>:</span>
                    <span class=c1># legacy instance</span>
                    <span class=n>family</span> <span class=o>=</span> <span class=n>_get_attr</span><span class=p>(</span><span class=n>node</span><span class=p>,</span> <span class=n>attr</span><span class=o>=</span><span class=s2>&quot;family&quot;</span><span class=p>)</span>
                    <span class=k>if</span> <span class=n>family</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
                        <span class=c1># must be a broken instance</span>
                        <span class=k>continue</span>

                    <span class=n>cache_legacy</span><span class=o>.</span><span class=n>setdefault</span><span class=p>(</span><span class=n>family</span><span class=p>,</span> <span class=p>[])</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>

            <span class=n>shared_data</span><span class=p>[</span><span class=s2>&quot;maya_cached_instance_data&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>cache</span>
            <span class=n>shared_data</span><span class=p>[</span><span class=s2>&quot;maya_cached_legacy_instances&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>cache_legacy</span>
        <span class=k>return</span> <span class=n>shared_data</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_publish_families</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Return families for the instances of this creator.</span>

<span class=sd>        Allow a Creator to define multiple families so that a creator can</span>
<span class=sd>        e.g. specify `usd` and `usdMaya` and another USD creator can also</span>
<span class=sd>        specify `usd` but apply different extractors like `usdMultiverse`.</span>

<span class=sd>        There is no need to override this method if you only have the</span>
<span class=sd>        &#39;product_type&#39; required for publish filtering.</span>

<span class=sd>        Returns:</span>
<span class=sd>            list: families for instances of this creator</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=p>[]</span>

    <span class=k>def</span><span class=w> </span><span class=nf>imprint_instance_node</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>node</span><span class=p>,</span> <span class=n>data</span><span class=p>):</span>

        <span class=c1># We never store the instance_node as value on the node since</span>
        <span class=c1># it&#39;s the node name itself</span>
        <span class=n>data</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;instance_node&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
        <span class=n>data</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;instance_id&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>

        <span class=c1># Don&#39;t store `families` since it&#39;s up to the creator itself</span>
        <span class=c1># to define the initial publish families - not a stored attribute of</span>
        <span class=c1># `families`</span>
        <span class=n>data</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;families&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>

        <span class=c1># We store creator attributes at the root level and assume they</span>
        <span class=c1># will not clash in names with `product`, `task`, etc. and other</span>
        <span class=c1># default names. This is just so these attributes in many cases</span>
        <span class=c1># are still editable in the maya UI by artists.</span>
        <span class=c1># note: pop to move to end of dict to sort attributes last on the node</span>
        <span class=n>creator_attributes</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;creator_attributes&quot;</span><span class=p>,</span> <span class=p>{})</span>

        <span class=c1># We only flatten value types which `imprint` function supports</span>
        <span class=n>json_creator_attributes</span> <span class=o>=</span> <span class=p>{}</span>
        <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=nb>dict</span><span class=p>(</span><span class=n>creator_attributes</span><span class=p>)</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=p>(</span><span class=nb>list</span><span class=p>,</span> <span class=nb>tuple</span><span class=p>,</span> <span class=nb>dict</span><span class=p>)):</span>
                <span class=n>creator_attributes</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>
                <span class=n>json_creator_attributes</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=n>value</span>

        <span class=c1># Flatten remaining creator attributes to the node itself</span>
        <span class=n>data</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>creator_attributes</span><span class=p>)</span>

        <span class=c1># We know the &quot;publish_attributes&quot; will be complex data of</span>
        <span class=c1># settings per plugins, we&#39;ll store this as a flattened json structure</span>
        <span class=c1># pop to move to end of dict to sort attributes last on the node</span>
        <span class=n>data</span><span class=p>[</span><span class=s2>&quot;publish_attributes&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span>
            <span class=n>data</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;publish_attributes&quot;</span><span class=p>,</span> <span class=p>{})</span>
        <span class=p>)</span>

        <span class=c1># Persist the non-flattened creator attributes (special value types,</span>
        <span class=c1># like multiselection EnumDef)</span>
        <span class=n>data</span><span class=p>[</span><span class=s2>&quot;creator_attributes&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>json_creator_attributes</span><span class=p>)</span>

        <span class=c1># Since we flattened the data structure for creator attributes we want</span>
        <span class=c1># to correctly detect which flattened attributes should end back in the</span>
        <span class=c1># creator attributes when reading the data from the node, so we store</span>
        <span class=c1># the relevant keys as a string</span>
        <span class=n>data</span><span class=p>[</span><span class=s2>&quot;__creator_attributes_keys&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;,&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>creator_attributes</span><span class=o>.</span><span class=n>keys</span><span class=p>())</span>

        <span class=c1># Kill any existing attributes just so we can imprint cleanly again</span>
        <span class=k>for</span> <span class=n>attr</span> <span class=ow>in</span> <span class=n>data</span><span class=o>.</span><span class=n>keys</span><span class=p>():</span>
            <span class=k>if</span> <span class=n>cmds</span><span class=o>.</span><span class=n>attributeQuery</span><span class=p>(</span><span class=n>attr</span><span class=p>,</span> <span class=n>node</span><span class=o>=</span><span class=n>node</span><span class=p>,</span> <span class=n>exists</span><span class=o>=</span><span class=kc>True</span><span class=p>):</span>
                <span class=n>cmds</span><span class=o>.</span><span class=n>deleteAttr</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>{}</span><span class=s2>.</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>node</span><span class=p>,</span> <span class=n>attr</span><span class=p>))</span>

        <span class=k>return</span> <span class=n>imprint</span><span class=p>(</span><span class=n>node</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>read_instance_node</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>node</span><span class=p>):</span>
        <span class=n>node_data</span> <span class=o>=</span> <span class=n>read</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>

        <span class=c1># Never care about a cbId attribute on the object set</span>
        <span class=c1># being read as &#39;data&#39;</span>
        <span class=n>node_data</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;cbId&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>

        <span class=c1># Make sure we convert any creator attributes from the json string</span>
        <span class=n>creator_attributes</span> <span class=o>=</span> <span class=n>node_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;creator_attributes&quot;</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>creator_attributes</span><span class=p>:</span>
            <span class=n>node_data</span><span class=p>[</span><span class=s2>&quot;creator_attributes&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>creator_attributes</span><span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>node_data</span><span class=p>[</span><span class=s2>&quot;creator_attributes&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>

        <span class=c1># Move the relevant attributes into &quot;creator_attributes&quot; that</span>
        <span class=c1># we flattened originally</span>
        <span class=n>creator_attribute_keys</span> <span class=o>=</span> <span class=n>node_data</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;__creator_attributes_keys&quot;</span><span class=p>,</span>
                                               <span class=s2>&quot;&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;,&quot;</span><span class=p>)</span>
        <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>creator_attribute_keys</span><span class=p>:</span>
            <span class=k>if</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>node_data</span><span class=p>:</span>
                <span class=n>node_data</span><span class=p>[</span><span class=s2>&quot;creator_attributes&quot;</span><span class=p>][</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=n>node_data</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>

        <span class=c1># Make sure we convert any publish attributes from the json string</span>
        <span class=n>publish_attributes</span> <span class=o>=</span> <span class=n>node_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;publish_attributes&quot;</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>publish_attributes</span><span class=p>:</span>
            <span class=n>node_data</span><span class=p>[</span><span class=s2>&quot;publish_attributes&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>publish_attributes</span><span class=p>)</span>

        <span class=c1># Explicitly re-parse the node name</span>
        <span class=n>node_data</span><span class=p>[</span><span class=s2>&quot;instance_node&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>node</span>
        <span class=n>node_data</span><span class=p>[</span><span class=s2>&quot;instance_id&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>node</span>

        <span class=c1># If the creator plug-in specifies</span>
        <span class=n>families</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_publish_families</span><span class=p>()</span>
        <span class=k>if</span> <span class=n>families</span><span class=p>:</span>
            <span class=n>node_data</span><span class=p>[</span><span class=s2>&quot;families&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>families</span>

        <span class=k>return</span> <span class=n>node_data</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_default_collect_instances</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>cache_instance_data</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>collection_shared_data</span><span class=p>)</span>
        <span class=n>cached_instances</span> <span class=o>=</span> <span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>collection_shared_data</span><span class=p>[</span><span class=s2>&quot;maya_cached_instance_data&quot;</span><span class=p>]</span>
        <span class=p>)</span>
        <span class=k>for</span> <span class=n>node</span> <span class=ow>in</span> <span class=n>cached_instances</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>identifier</span><span class=p>,</span> <span class=p>[]):</span>
            <span class=n>node_data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>read_instance_node</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>

            <span class=n>created_instance</span> <span class=o>=</span> <span class=n>CreatedInstance</span><span class=o>.</span><span class=n>from_existing</span><span class=p>(</span><span class=n>node_data</span><span class=p>,</span> <span class=bp>self</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_add_instance_to_context</span><span class=p>(</span><span class=n>created_instance</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_default_update_instances</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>update_list</span><span class=p>):</span>
        <span class=k>for</span> <span class=n>created_inst</span><span class=p>,</span> <span class=n>_changes</span> <span class=ow>in</span> <span class=n>update_list</span><span class=p>:</span>
            <span class=n>data</span> <span class=o>=</span> <span class=n>created_inst</span><span class=o>.</span><span class=n>data_to_store</span><span class=p>()</span>
            <span class=n>node</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;instance_node&quot;</span><span class=p>)</span>

            <span class=bp>self</span><span class=o>.</span><span class=n>imprint_instance_node</span><span class=p>(</span><span class=n>node</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span>

    <span class=nd>@lib</span><span class=o>.</span><span class=n>undo_chunk</span><span class=p>()</span>
    <span class=k>def</span><span class=w> </span><span class=nf>_default_remove_instances</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>instances</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Remove specified instance from the scene.</span>

<span class=sd>        This is only removing `id` parameter so instance is no longer</span>
<span class=sd>        instance, because it might contain valuable data for artist.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>for</span> <span class=n>instance</span> <span class=ow>in</span> <span class=n>instances</span><span class=p>:</span>
            <span class=n>node</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;instance_node&quot;</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>node</span><span class=p>:</span>
                <span class=n>cmds</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>

            <span class=bp>self</span><span class=o>.</span><span class=n>_remove_instance_from_context</span><span class=p>(</span><span class=n>instance</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h3 id=client.ayon_maya.api.plugin.MayaCreatorBase.cache_instance_data class="doc doc-heading"> <code class="highlight language-python"><span class=n>cache_instance_data</span><span class=p>(</span><span class=n>shared_data</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small> </span> </h3> <div class="doc doc-contents "> <p>Cache instances for Creators to shared data.</p> <p>Create <code>maya_cached_instance_data</code> key when needed in shared data and fill it with all collected instances from the scene under its respective creator identifiers.</p> <p>If legacy instances are detected in the scene, create <code>maya_cached_legacy_instances</code> there and fill it with all legacy products under product type as a key.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>Dict[str,</code> </td> <td> <code>Any]</code> </td> <td> <div class=doc-md-description> <p>Shared data.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_maya/api/plugin.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@staticmethod</span>
<span class=k>def</span><span class=w> </span><span class=nf>cache_instance_data</span><span class=p>(</span><span class=n>shared_data</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Cache instances for Creators to shared data.</span>

<span class=sd>    Create `maya_cached_instance_data` key when needed in shared data and</span>
<span class=sd>    fill it with all collected instances from the scene under its</span>
<span class=sd>    respective creator identifiers.</span>

<span class=sd>    If legacy instances are detected in the scene, create</span>
<span class=sd>    `maya_cached_legacy_instances` there and fill it with</span>
<span class=sd>    all legacy products under product type as a key.</span>

<span class=sd>    Args:</span>
<span class=sd>        Dict[str, Any]: Shared data.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=n>shared_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;maya_cached_instance_data&quot;</span><span class=p>)</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>cache</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>()</span>
        <span class=n>cache_legacy</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>()</span>

        <span class=k>for</span> <span class=n>node</span> <span class=ow>in</span> <span class=n>cmds</span><span class=o>.</span><span class=n>ls</span><span class=p>(</span><span class=nb>type</span><span class=o>=</span><span class=s2>&quot;objectSet&quot;</span><span class=p>):</span>

            <span class=k>if</span> <span class=n>_get_attr</span><span class=p>(</span><span class=n>node</span><span class=p>,</span> <span class=n>attr</span><span class=o>=</span><span class=s2>&quot;id&quot;</span><span class=p>)</span> <span class=ow>not</span> <span class=ow>in</span> <span class=p>{</span>
                <span class=n>AYON_INSTANCE_ID</span><span class=p>,</span> <span class=n>AVALON_INSTANCE_ID</span>
            <span class=p>}:</span>
                <span class=k>continue</span>

            <span class=n>creator_id</span> <span class=o>=</span> <span class=n>_get_attr</span><span class=p>(</span><span class=n>node</span><span class=p>,</span> <span class=n>attr</span><span class=o>=</span><span class=s2>&quot;creator_identifier&quot;</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>creator_id</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
                <span class=c1># creator instance</span>
                <span class=n>cache</span><span class=o>.</span><span class=n>setdefault</span><span class=p>(</span><span class=n>creator_id</span><span class=p>,</span> <span class=p>[])</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=c1># legacy instance</span>
                <span class=n>family</span> <span class=o>=</span> <span class=n>_get_attr</span><span class=p>(</span><span class=n>node</span><span class=p>,</span> <span class=n>attr</span><span class=o>=</span><span class=s2>&quot;family&quot;</span><span class=p>)</span>
                <span class=k>if</span> <span class=n>family</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
                    <span class=c1># must be a broken instance</span>
                    <span class=k>continue</span>

                <span class=n>cache_legacy</span><span class=o>.</span><span class=n>setdefault</span><span class=p>(</span><span class=n>family</span><span class=p>,</span> <span class=p>[])</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>

        <span class=n>shared_data</span><span class=p>[</span><span class=s2>&quot;maya_cached_instance_data&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>cache</span>
        <span class=n>shared_data</span><span class=p>[</span><span class=s2>&quot;maya_cached_legacy_instances&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>cache_legacy</span>
    <span class=k>return</span> <span class=n>shared_data</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_maya.api.plugin.MayaCreatorBase.get_publish_families class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_publish_families</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Return families for the instances of this creator.</p> <p>Allow a Creator to define multiple families so that a creator can e.g. specify <code>usd</code> and <code>usdMaya</code> and another USD creator can also specify <code>usd</code> but apply different extractors like <code>usdMultiverse</code>.</p> <p>There is no need to override this method if you only have the 'product_type' required for publish filtering.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>list</code></td> <td> </td> <td> <div class=doc-md-description> <p>families for instances of this creator</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_maya/api/plugin.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>156</span>
<span class=normal>157</span>
<span class=normal>158</span>
<span class=normal>159</span>
<span class=normal>160</span>
<span class=normal>161</span>
<span class=normal>162</span>
<span class=normal>163</span>
<span class=normal>164</span>
<span class=normal>165</span>
<span class=normal>166</span>
<span class=normal>167</span>
<span class=normal>168</span>
<span class=normal>169</span>
<span class=normal>170</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_publish_families</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Return families for the instances of this creator.</span>

<span class=sd>    Allow a Creator to define multiple families so that a creator can</span>
<span class=sd>    e.g. specify `usd` and `usdMaya` and another USD creator can also</span>
<span class=sd>    specify `usd` but apply different extractors like `usdMultiverse`.</span>

<span class=sd>    There is no need to override this method if you only have the</span>
<span class=sd>    &#39;product_type&#39; required for publish filtering.</span>

<span class=sd>    Returns:</span>
<span class=sd>        list: families for instances of this creator</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=p>[]</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h2 id=client.ayon_maya.api.plugin.MayaExtractorPlugin class="doc doc-heading"> <code>MayaExtractorPlugin</code> </h2> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=ayon_core.pipeline.publish.Extractor>Extractor</span></code></p> <p>Base class for extract plugins.</p> <details class=quote> <summary>Source code in <code>client/ayon_maya/api/plugin.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1089</span>
<span class=normal>1090</span>
<span class=normal>1091</span>
<span class=normal>1092</span>
<span class=normal>1093</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>MayaExtractorPlugin</span><span class=p>(</span><span class=n>publish</span><span class=o>.</span><span class=n>Extractor</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Base class for extract plugins.&quot;&quot;&quot;</span>

    <span class=n>settings_category</span> <span class=o>=</span> <span class=n>SETTINGS_CATEGORY</span>
    <span class=n>hosts</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;maya&quot;</span><span class=p>]</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h2 id=client.ayon_maya.api.plugin.MayaHiddenCreator class="doc doc-heading"> <code>MayaHiddenCreator</code> </h2> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=ayon_core.pipeline.HiddenCreator>HiddenCreator</span></code>, <code><a class="autorefs autorefs-internal" title="MayaCreatorBase (client.ayon_maya.api.plugin.MayaCreatorBase)" href=#client.ayon_maya.api.plugin.MayaCreatorBase>MayaCreatorBase</a></code></p> <p>Hidden creator for Maya.</p> <p>The plugin is not visible in UI, and it does not have strictly defined arguments for 'create' method.</p> <details class=quote> <summary>Source code in <code>client/ayon_maya/api/plugin.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>365</span>
<span class=normal>366</span>
<span class=normal>367</span>
<span class=normal>368</span>
<span class=normal>369</span>
<span class=normal>370</span>
<span class=normal>371</span>
<span class=normal>372</span>
<span class=normal>373</span>
<span class=normal>374</span>
<span class=normal>375</span>
<span class=normal>376</span>
<span class=normal>377</span>
<span class=normal>378</span>
<span class=normal>379</span>
<span class=normal>380</span>
<span class=normal>381</span>
<span class=normal>382</span>
<span class=normal>383</span>
<span class=normal>384</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>MayaHiddenCreator</span><span class=p>(</span><span class=n>HiddenCreator</span><span class=p>,</span> <span class=n>MayaCreatorBase</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Hidden creator for Maya.</span>

<span class=sd>    The plugin is not visible in UI, and it does not have strictly defined</span>
<span class=sd>        arguments for &#39;create&#39; method.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>settings_category</span> <span class=o>=</span> <span class=s2>&quot;maya&quot;</span>

    <span class=k>def</span><span class=w> </span><span class=nf>create</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
        <span class=k>return</span> <span class=n>MayaCreator</span><span class=o>.</span><span class=n>create</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>collect_instances</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_default_collect_instances</span><span class=p>()</span>

    <span class=k>def</span><span class=w> </span><span class=nf>update_instances</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>update_list</span><span class=p>):</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_default_update_instances</span><span class=p>(</span><span class=n>update_list</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>remove_instances</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>instances</span><span class=p>):</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_default_remove_instances</span><span class=p>(</span><span class=n>instances</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h2 id=client.ayon_maya.api.plugin.MayaInstancePlugin class="doc doc-heading"> <code>MayaInstancePlugin</code> </h2> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=pyblish.api.InstancePlugin>InstancePlugin</span></code></p> <p>Base class for instance publish plugins.</p> <details class=quote> <summary>Source code in <code>client/ayon_maya/api/plugin.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1075</span>
<span class=normal>1076</span>
<span class=normal>1077</span>
<span class=normal>1078</span>
<span class=normal>1079</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>MayaInstancePlugin</span><span class=p>(</span><span class=n>InstancePlugin</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Base class for instance publish plugins.&quot;&quot;&quot;</span>

    <span class=n>settings_category</span> <span class=o>=</span> <span class=n>SETTINGS_CATEGORY</span>
    <span class=n>hosts</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;maya&quot;</span><span class=p>]</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h2 id=client.ayon_maya.api.plugin.MayaLoader class="doc doc-heading"> <code>MayaLoader</code> </h2> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=ayon_core.pipeline.LoaderPlugin>LoaderPlugin</span></code></p> <p>Base class for loader plugins.</p> <details class=quote> <summary>Source code in <code>client/ayon_maya/api/plugin.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1069</span>
<span class=normal>1070</span>
<span class=normal>1071</span>
<span class=normal>1072</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>MayaLoader</span><span class=p>(</span><span class=n>LoaderPlugin</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Base class for loader plugins.&quot;&quot;&quot;</span>

    <span class=n>settings_category</span> <span class=o>=</span> <span class=n>SETTINGS_CATEGORY</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h2 id=client.ayon_maya.api.plugin.ReferenceLoader class="doc doc-heading"> <code>ReferenceLoader</code> </h2> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title="Loader (client.ayon_maya.api.plugin.Loader)" href=#client.ayon_maya.api.plugin.Loader>Loader</a></code></p> <p>A basic ReferenceLoader for Maya</p> <p>This will implement the basic behavior for a loader to inherit from that will containerize the reference and will implement the <code>remove</code> and <code>update</code> logic.</p> <details class=quote> <summary>Source code in <code>client/ayon_maya/api/plugin.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 743</span>
<span class=normal> 744</span>
<span class=normal> 745</span>
<span class=normal> 746</span>
<span class=normal> 747</span>
<span class=normal> 748</span>
<span class=normal> 749</span>
<span class=normal> 750</span>
<span class=normal> 751</span>
<span class=normal> 752</span>
<span class=normal> 753</span>
<span class=normal> 754</span>
<span class=normal> 755</span>
<span class=normal> 756</span>
<span class=normal> 757</span>
<span class=normal> 758</span>
<span class=normal> 759</span>
<span class=normal> 760</span>
<span class=normal> 761</span>
<span class=normal> 762</span>
<span class=normal> 763</span>
<span class=normal> 764</span>
<span class=normal> 765</span>
<span class=normal> 766</span>
<span class=normal> 767</span>
<span class=normal> 768</span>
<span class=normal> 769</span>
<span class=normal> 770</span>
<span class=normal> 771</span>
<span class=normal> 772</span>
<span class=normal> 773</span>
<span class=normal> 774</span>
<span class=normal> 775</span>
<span class=normal> 776</span>
<span class=normal> 777</span>
<span class=normal> 778</span>
<span class=normal> 779</span>
<span class=normal> 780</span>
<span class=normal> 781</span>
<span class=normal> 782</span>
<span class=normal> 783</span>
<span class=normal> 784</span>
<span class=normal> 785</span>
<span class=normal> 786</span>
<span class=normal> 787</span>
<span class=normal> 788</span>
<span class=normal> 789</span>
<span class=normal> 790</span>
<span class=normal> 791</span>
<span class=normal> 792</span>
<span class=normal> 793</span>
<span class=normal> 794</span>
<span class=normal> 795</span>
<span class=normal> 796</span>
<span class=normal> 797</span>
<span class=normal> 798</span>
<span class=normal> 799</span>
<span class=normal> 800</span>
<span class=normal> 801</span>
<span class=normal> 802</span>
<span class=normal> 803</span>
<span class=normal> 804</span>
<span class=normal> 805</span>
<span class=normal> 806</span>
<span class=normal> 807</span>
<span class=normal> 808</span>
<span class=normal> 809</span>
<span class=normal> 810</span>
<span class=normal> 811</span>
<span class=normal> 812</span>
<span class=normal> 813</span>
<span class=normal> 814</span>
<span class=normal> 815</span>
<span class=normal> 816</span>
<span class=normal> 817</span>
<span class=normal> 818</span>
<span class=normal> 819</span>
<span class=normal> 820</span>
<span class=normal> 821</span>
<span class=normal> 822</span>
<span class=normal> 823</span>
<span class=normal> 824</span>
<span class=normal> 825</span>
<span class=normal> 826</span>
<span class=normal> 827</span>
<span class=normal> 828</span>
<span class=normal> 829</span>
<span class=normal> 830</span>
<span class=normal> 831</span>
<span class=normal> 832</span>
<span class=normal> 833</span>
<span class=normal> 834</span>
<span class=normal> 835</span>
<span class=normal> 836</span>
<span class=normal> 837</span>
<span class=normal> 838</span>
<span class=normal> 839</span>
<span class=normal> 840</span>
<span class=normal> 841</span>
<span class=normal> 842</span>
<span class=normal> 843</span>
<span class=normal> 844</span>
<span class=normal> 845</span>
<span class=normal> 846</span>
<span class=normal> 847</span>
<span class=normal> 848</span>
<span class=normal> 849</span>
<span class=normal> 850</span>
<span class=normal> 851</span>
<span class=normal> 852</span>
<span class=normal> 853</span>
<span class=normal> 854</span>
<span class=normal> 855</span>
<span class=normal> 856</span>
<span class=normal> 857</span>
<span class=normal> 858</span>
<span class=normal> 859</span>
<span class=normal> 860</span>
<span class=normal> 861</span>
<span class=normal> 862</span>
<span class=normal> 863</span>
<span class=normal> 864</span>
<span class=normal> 865</span>
<span class=normal> 866</span>
<span class=normal> 867</span>
<span class=normal> 868</span>
<span class=normal> 869</span>
<span class=normal> 870</span>
<span class=normal> 871</span>
<span class=normal> 872</span>
<span class=normal> 873</span>
<span class=normal> 874</span>
<span class=normal> 875</span>
<span class=normal> 876</span>
<span class=normal> 877</span>
<span class=normal> 878</span>
<span class=normal> 879</span>
<span class=normal> 880</span>
<span class=normal> 881</span>
<span class=normal> 882</span>
<span class=normal> 883</span>
<span class=normal> 884</span>
<span class=normal> 885</span>
<span class=normal> 886</span>
<span class=normal> 887</span>
<span class=normal> 888</span>
<span class=normal> 889</span>
<span class=normal> 890</span>
<span class=normal> 891</span>
<span class=normal> 892</span>
<span class=normal> 893</span>
<span class=normal> 894</span>
<span class=normal> 895</span>
<span class=normal> 896</span>
<span class=normal> 897</span>
<span class=normal> 898</span>
<span class=normal> 899</span>
<span class=normal> 900</span>
<span class=normal> 901</span>
<span class=normal> 902</span>
<span class=normal> 903</span>
<span class=normal> 904</span>
<span class=normal> 905</span>
<span class=normal> 906</span>
<span class=normal> 907</span>
<span class=normal> 908</span>
<span class=normal> 909</span>
<span class=normal> 910</span>
<span class=normal> 911</span>
<span class=normal> 912</span>
<span class=normal> 913</span>
<span class=normal> 914</span>
<span class=normal> 915</span>
<span class=normal> 916</span>
<span class=normal> 917</span>
<span class=normal> 918</span>
<span class=normal> 919</span>
<span class=normal> 920</span>
<span class=normal> 921</span>
<span class=normal> 922</span>
<span class=normal> 923</span>
<span class=normal> 924</span>
<span class=normal> 925</span>
<span class=normal> 926</span>
<span class=normal> 927</span>
<span class=normal> 928</span>
<span class=normal> 929</span>
<span class=normal> 930</span>
<span class=normal> 931</span>
<span class=normal> 932</span>
<span class=normal> 933</span>
<span class=normal> 934</span>
<span class=normal> 935</span>
<span class=normal> 936</span>
<span class=normal> 937</span>
<span class=normal> 938</span>
<span class=normal> 939</span>
<span class=normal> 940</span>
<span class=normal> 941</span>
<span class=normal> 942</span>
<span class=normal> 943</span>
<span class=normal> 944</span>
<span class=normal> 945</span>
<span class=normal> 946</span>
<span class=normal> 947</span>
<span class=normal> 948</span>
<span class=normal> 949</span>
<span class=normal> 950</span>
<span class=normal> 951</span>
<span class=normal> 952</span>
<span class=normal> 953</span>
<span class=normal> 954</span>
<span class=normal> 955</span>
<span class=normal> 956</span>
<span class=normal> 957</span>
<span class=normal> 958</span>
<span class=normal> 959</span>
<span class=normal> 960</span>
<span class=normal> 961</span>
<span class=normal> 962</span>
<span class=normal> 963</span>
<span class=normal> 964</span>
<span class=normal> 965</span>
<span class=normal> 966</span>
<span class=normal> 967</span>
<span class=normal> 968</span>
<span class=normal> 969</span>
<span class=normal> 970</span>
<span class=normal> 971</span>
<span class=normal> 972</span>
<span class=normal> 973</span>
<span class=normal> 974</span>
<span class=normal> 975</span>
<span class=normal> 976</span>
<span class=normal> 977</span>
<span class=normal> 978</span>
<span class=normal> 979</span>
<span class=normal> 980</span>
<span class=normal> 981</span>
<span class=normal> 982</span>
<span class=normal> 983</span>
<span class=normal> 984</span>
<span class=normal> 985</span>
<span class=normal> 986</span>
<span class=normal> 987</span>
<span class=normal> 988</span>
<span class=normal> 989</span>
<span class=normal> 990</span>
<span class=normal> 991</span>
<span class=normal> 992</span>
<span class=normal> 993</span>
<span class=normal> 994</span>
<span class=normal> 995</span>
<span class=normal> 996</span>
<span class=normal> 997</span>
<span class=normal> 998</span>
<span class=normal> 999</span>
<span class=normal>1000</span>
<span class=normal>1001</span>
<span class=normal>1002</span>
<span class=normal>1003</span>
<span class=normal>1004</span>
<span class=normal>1005</span>
<span class=normal>1006</span>
<span class=normal>1007</span>
<span class=normal>1008</span>
<span class=normal>1009</span>
<span class=normal>1010</span>
<span class=normal>1011</span>
<span class=normal>1012</span>
<span class=normal>1013</span>
<span class=normal>1014</span>
<span class=normal>1015</span>
<span class=normal>1016</span>
<span class=normal>1017</span>
<span class=normal>1018</span>
<span class=normal>1019</span>
<span class=normal>1020</span>
<span class=normal>1021</span>
<span class=normal>1022</span>
<span class=normal>1023</span>
<span class=normal>1024</span>
<span class=normal>1025</span>
<span class=normal>1026</span>
<span class=normal>1027</span>
<span class=normal>1028</span>
<span class=normal>1029</span>
<span class=normal>1030</span>
<span class=normal>1031</span>
<span class=normal>1032</span>
<span class=normal>1033</span>
<span class=normal>1034</span>
<span class=normal>1035</span>
<span class=normal>1036</span>
<span class=normal>1037</span>
<span class=normal>1038</span>
<span class=normal>1039</span>
<span class=normal>1040</span>
<span class=normal>1041</span>
<span class=normal>1042</span>
<span class=normal>1043</span>
<span class=normal>1044</span>
<span class=normal>1045</span>
<span class=normal>1046</span>
<span class=normal>1047</span>
<span class=normal>1048</span>
<span class=normal>1049</span>
<span class=normal>1050</span>
<span class=normal>1051</span>
<span class=normal>1052</span>
<span class=normal>1053</span>
<span class=normal>1054</span>
<span class=normal>1055</span>
<span class=normal>1056</span>
<span class=normal>1057</span>
<span class=normal>1058</span>
<span class=normal>1059</span>
<span class=normal>1060</span>
<span class=normal>1061</span>
<span class=normal>1062</span>
<span class=normal>1063</span>
<span class=normal>1064</span>
<span class=normal>1065</span>
<span class=normal>1066</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>ReferenceLoader</span><span class=p>(</span><span class=n>Loader</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;A basic ReferenceLoader for Maya</span>

<span class=sd>    This will implement the basic behavior for a loader to inherit from that</span>
<span class=sd>    will containerize the reference and will implement the `remove` and</span>
<span class=sd>    `update` logic.</span>

<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>options</span> <span class=o>=</span> <span class=p>[</span>
        <span class=n>qargparse</span><span class=o>.</span><span class=n>Integer</span><span class=p>(</span>
            <span class=s2>&quot;count&quot;</span><span class=p>,</span>
            <span class=n>label</span><span class=o>=</span><span class=s2>&quot;Count&quot;</span><span class=p>,</span>
            <span class=n>default</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>
            <span class=nb>min</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>
            <span class=n>help</span><span class=o>=</span><span class=s2>&quot;How many times to load?&quot;</span>
        <span class=p>),</span>
        <span class=n>qargparse</span><span class=o>.</span><span class=n>Double3</span><span class=p>(</span>
            <span class=s2>&quot;offset&quot;</span><span class=p>,</span>
            <span class=n>label</span><span class=o>=</span><span class=s2>&quot;Position Offset&quot;</span><span class=p>,</span>
            <span class=n>help</span><span class=o>=</span><span class=s2>&quot;Offset loaded models for easier selection.&quot;</span>
        <span class=p>),</span>
        <span class=n>qargparse</span><span class=o>.</span><span class=n>Boolean</span><span class=p>(</span>
            <span class=s2>&quot;attach_to_root&quot;</span><span class=p>,</span>
            <span class=n>label</span><span class=o>=</span><span class=s2>&quot;Group imported asset&quot;</span><span class=p>,</span>
            <span class=n>default</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
            <span class=n>help</span><span class=o>=</span><span class=s2>&quot;Should a group be created to encapsulate&quot;</span>
                 <span class=s2>&quot; imported representation ?&quot;</span>
        <span class=p>)</span>
    <span class=p>]</span>

    <span class=k>def</span><span class=w> </span><span class=nf>load</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>context</span><span class=p>,</span>
        <span class=n>name</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
        <span class=n>namespace</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
        <span class=n>options</span><span class=o>=</span><span class=kc>None</span>
    <span class=p>):</span>
        <span class=n>path</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>filepath_from_context</span><span class=p>(</span><span class=n>context</span><span class=p>)</span>
        <span class=k>assert</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>path</span><span class=p>),</span> <span class=s2>&quot;</span><span class=si>%s</span><span class=s2> does not exist.&quot;</span> <span class=o>%</span> <span class=n>path</span>

        <span class=n>custom_group_name</span><span class=p>,</span> <span class=n>custom_namespace</span><span class=p>,</span> <span class=n>options</span> <span class=o>=</span> \
            <span class=bp>self</span><span class=o>.</span><span class=n>get_custom_namespace_and_group</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>options</span><span class=p>,</span>
                                                <span class=s2>&quot;reference_loader&quot;</span><span class=p>)</span>

        <span class=n>count</span> <span class=o>=</span> <span class=n>options</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;count&quot;</span><span class=p>)</span> <span class=ow>or</span> <span class=mi>1</span>

        <span class=n>loaded_containers</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>count</span><span class=p>):</span>
            <span class=n>namespace</span> <span class=o>=</span> <span class=n>lib</span><span class=o>.</span><span class=n>get_custom_namespace</span><span class=p>(</span><span class=n>custom_namespace</span><span class=p>)</span>
            <span class=n>group_name</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>:</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                <span class=n>namespace</span><span class=p>,</span>
                <span class=n>custom_group_name</span>
            <span class=p>)</span>

            <span class=n>options</span><span class=p>[</span><span class=s1>&#39;group_name&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>group_name</span>

            <span class=c1># Offset loaded product</span>
            <span class=k>if</span> <span class=s2>&quot;offset&quot;</span> <span class=ow>in</span> <span class=n>options</span><span class=p>:</span>
                <span class=n>offset</span> <span class=o>=</span> <span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=n>c</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>options</span><span class=p>[</span><span class=s2>&quot;offset&quot;</span><span class=p>]]</span>
                <span class=n>options</span><span class=p>[</span><span class=s2>&quot;translate&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>offset</span>

            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=n>options</span><span class=p>)</span>

            <span class=bp>self</span><span class=o>.</span><span class=n>process_reference</span><span class=p>(</span>
                <span class=n>context</span><span class=o>=</span><span class=n>context</span><span class=p>,</span>
                <span class=n>name</span><span class=o>=</span><span class=n>name</span><span class=p>,</span>
                <span class=n>namespace</span><span class=o>=</span><span class=n>namespace</span><span class=p>,</span>
                <span class=n>options</span><span class=o>=</span><span class=n>options</span>
            <span class=p>)</span>

            <span class=c1># Only containerize if any nodes were loaded by the Loader</span>
            <span class=n>nodes</span> <span class=o>=</span> <span class=bp>self</span><span class=p>[:]</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>nodes</span><span class=p>:</span>
                <span class=k>return</span>

            <span class=n>ref_node</span> <span class=o>=</span> <span class=n>lib</span><span class=o>.</span><span class=n>get_reference_node</span><span class=p>(</span><span class=n>nodes</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=p>)</span>
            <span class=n>container</span> <span class=o>=</span> <span class=n>containerise</span><span class=p>(</span>
                <span class=n>name</span><span class=o>=</span><span class=n>name</span><span class=p>,</span>
                <span class=n>namespace</span><span class=o>=</span><span class=n>namespace</span><span class=p>,</span>
                <span class=n>nodes</span><span class=o>=</span><span class=p>[</span><span class=n>ref_node</span><span class=p>],</span>
                <span class=n>context</span><span class=o>=</span><span class=n>context</span><span class=p>,</span>
                <span class=n>loader</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__name__</span>
            <span class=p>)</span>
            <span class=n>loaded_containers</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>container</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_organize_containers</span><span class=p>(</span><span class=n>nodes</span><span class=p>,</span> <span class=n>container</span><span class=p>)</span>
            <span class=n>c</span> <span class=o>+=</span> <span class=mi>1</span>

        <span class=k>return</span> <span class=n>loaded_containers</span>

    <span class=k>def</span><span class=w> </span><span class=nf>process_reference</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>context</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>namespace</span><span class=p>,</span> <span class=n>options</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;To be implemented by subclass&quot;&quot;&quot;</span>
        <span class=k>raise</span> <span class=ne>NotImplementedError</span><span class=p>(</span><span class=s2>&quot;Must be implemented by subclass&quot;</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>update</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>container</span><span class=p>,</span> <span class=n>context</span><span class=p>):</span>
        <span class=kn>from</span><span class=w> </span><span class=nn>ayon_maya.api.lib</span><span class=w> </span><span class=kn>import</span> <span class=n>get_container_members</span>
        <span class=kn>from</span><span class=w> </span><span class=nn>maya</span><span class=w> </span><span class=kn>import</span> <span class=n>cmds</span>

        <span class=n>node</span> <span class=o>=</span> <span class=n>container</span><span class=p>[</span><span class=s2>&quot;objectName&quot;</span><span class=p>]</span>

        <span class=n>project_name</span> <span class=o>=</span> <span class=n>context</span><span class=p>[</span><span class=s2>&quot;project&quot;</span><span class=p>][</span><span class=s2>&quot;name&quot;</span><span class=p>]</span>
        <span class=n>repre_entity</span> <span class=o>=</span> <span class=n>context</span><span class=p>[</span><span class=s2>&quot;representation&quot;</span><span class=p>]</span>

        <span class=n>path</span> <span class=o>=</span> <span class=n>get_representation_path</span><span class=p>(</span><span class=n>repre_entity</span><span class=p>)</span>

        <span class=c1># Get reference node from container members</span>
        <span class=n>members</span> <span class=o>=</span> <span class=n>get_container_members</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>
        <span class=n>reference_node</span> <span class=o>=</span> <span class=n>lib</span><span class=o>.</span><span class=n>get_reference_node</span><span class=p>(</span><span class=n>members</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>reference_node</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=k>raise</span> <span class=n>LoadError</span><span class=p>(</span><span class=s2>&quot;No reference node found in container&quot;</span><span class=p>)</span>
        <span class=n>namespace</span> <span class=o>=</span> <span class=n>cmds</span><span class=o>.</span><span class=n>referenceQuery</span><span class=p>(</span><span class=n>reference_node</span><span class=p>,</span> <span class=n>namespace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

        <span class=n>file_type</span> <span class=o>=</span> <span class=p>{</span>
            <span class=s2>&quot;ma&quot;</span><span class=p>:</span> <span class=s2>&quot;mayaAscii&quot;</span><span class=p>,</span>
            <span class=s2>&quot;mb&quot;</span><span class=p>:</span> <span class=s2>&quot;mayaBinary&quot;</span><span class=p>,</span>
            <span class=s2>&quot;abc&quot;</span><span class=p>:</span> <span class=s2>&quot;Alembic&quot;</span><span class=p>,</span>
            <span class=s2>&quot;fbx&quot;</span><span class=p>:</span> <span class=s2>&quot;FBX&quot;</span><span class=p>,</span>
            <span class=s2>&quot;usd&quot;</span><span class=p>:</span> <span class=s2>&quot;USD Import&quot;</span>
        <span class=p>}</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>repre_entity</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>])</span>

        <span class=k>if</span> <span class=n>file_type</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=k>raise</span> <span class=n>LoadError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Unsupported representation: </span><span class=si>{</span><span class=n>repre_entity</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>

        <span class=k>assert</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>path</span><span class=p>),</span> <span class=s2>&quot;</span><span class=si>%s</span><span class=s2> does not exist.&quot;</span> <span class=o>%</span> <span class=n>path</span>

        <span class=c1># Need to save alembic settings and reapply, cause referencing resets</span>
        <span class=c1># them to incoming data.</span>
        <span class=n>alembic_attrs</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;speed&quot;</span><span class=p>,</span> <span class=s2>&quot;offset&quot;</span><span class=p>,</span> <span class=s2>&quot;cycleType&quot;</span><span class=p>,</span> <span class=s2>&quot;time&quot;</span><span class=p>]</span>
        <span class=n>alembic_data</span> <span class=o>=</span> <span class=p>{}</span>
        <span class=k>if</span> <span class=n>repre_entity</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&quot;abc&quot;</span><span class=p>:</span>
            <span class=n>alembic_nodes</span> <span class=o>=</span> <span class=n>cmds</span><span class=o>.</span><span class=n>ls</span><span class=p>(</span>
                <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>:*&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>namespace</span><span class=p>),</span> <span class=nb>type</span><span class=o>=</span><span class=s2>&quot;AlembicNode&quot;</span>
            <span class=p>)</span>
            <span class=k>if</span> <span class=n>alembic_nodes</span><span class=p>:</span>
                <span class=k>for</span> <span class=n>attr</span> <span class=ow>in</span> <span class=n>alembic_attrs</span><span class=p>:</span>
                    <span class=n>node_attr</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>.</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>alembic_nodes</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>attr</span><span class=p>)</span>
                    <span class=n>data</span> <span class=o>=</span> <span class=p>{</span>
                        <span class=s2>&quot;input&quot;</span><span class=p>:</span> <span class=n>lib</span><span class=o>.</span><span class=n>get_attribute_input</span><span class=p>(</span><span class=n>node_attr</span><span class=p>),</span>
                        <span class=s2>&quot;value&quot;</span><span class=p>:</span> <span class=n>cmds</span><span class=o>.</span><span class=n>getAttr</span><span class=p>(</span><span class=n>node_attr</span><span class=p>)</span>
                    <span class=p>}</span>

                    <span class=n>alembic_data</span><span class=p>[</span><span class=n>attr</span><span class=p>]</span> <span class=o>=</span> <span class=n>data</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;No alembic nodes found in </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>members</span><span class=p>))</span>

        <span class=k>try</span><span class=p>:</span>
            <span class=n>path</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>prepare_root_value</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=n>project_name</span><span class=p>)</span>
            <span class=n>content</span> <span class=o>=</span> <span class=n>cmds</span><span class=o>.</span><span class=n>file</span><span class=p>(</span><span class=n>path</span><span class=p>,</span>
                                <span class=n>loadReference</span><span class=o>=</span><span class=n>reference_node</span><span class=p>,</span>
                                <span class=nb>type</span><span class=o>=</span><span class=n>file_type</span><span class=p>,</span>
                                <span class=n>returnNewNodes</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
        <span class=k>except</span> <span class=ne>RuntimeError</span> <span class=k>as</span> <span class=n>exc</span><span class=p>:</span>
            <span class=c1># When changing a reference to a file that has load errors the</span>
            <span class=c1># command will raise an error even if the file is still loaded</span>
            <span class=c1># correctly (e.g. when raising errors on Arnold attributes)</span>
            <span class=c1># When the file is loaded and has content, we consider it&#39;s fine.</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>cmds</span><span class=o>.</span><span class=n>referenceQuery</span><span class=p>(</span><span class=n>reference_node</span><span class=p>,</span> <span class=n>isLoaded</span><span class=o>=</span><span class=kc>True</span><span class=p>):</span>
                <span class=k>raise</span>

            <span class=n>content</span> <span class=o>=</span> <span class=n>cmds</span><span class=o>.</span><span class=n>referenceQuery</span><span class=p>(</span><span class=n>reference_node</span><span class=p>,</span>
                                          <span class=n>nodes</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
                                          <span class=n>dagPath</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>content</span><span class=p>:</span>
                <span class=k>raise</span>

            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&quot;Ignoring file read error:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>exc</span><span class=p>)</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_organize_containers</span><span class=p>(</span><span class=n>content</span><span class=p>,</span> <span class=n>container</span><span class=p>[</span><span class=s2>&quot;objectName&quot;</span><span class=p>])</span>

        <span class=c1># Reapply alembic settings.</span>
        <span class=k>if</span> <span class=n>repre_entity</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&quot;abc&quot;</span> <span class=ow>and</span> <span class=n>alembic_data</span><span class=p>:</span>
            <span class=n>alembic_nodes</span> <span class=o>=</span> <span class=n>cmds</span><span class=o>.</span><span class=n>ls</span><span class=p>(</span>
                <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>:*&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>namespace</span><span class=p>),</span> <span class=nb>type</span><span class=o>=</span><span class=s2>&quot;AlembicNode&quot;</span>
            <span class=p>)</span>
            <span class=k>if</span> <span class=n>alembic_nodes</span><span class=p>:</span>
                <span class=n>alembic_node</span> <span class=o>=</span> <span class=n>alembic_nodes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>  <span class=c1># assume single AlembicNode</span>
                <span class=k>for</span> <span class=n>attr</span><span class=p>,</span> <span class=n>data</span> <span class=ow>in</span> <span class=n>alembic_data</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
                    <span class=n>node_attr</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>.</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>alembic_node</span><span class=p>,</span> <span class=n>attr</span><span class=p>)</span>
                    <span class=nb>input</span> <span class=o>=</span> <span class=n>lib</span><span class=o>.</span><span class=n>get_attribute_input</span><span class=p>(</span><span class=n>node_attr</span><span class=p>)</span>
                    <span class=k>if</span> <span class=n>data</span><span class=p>[</span><span class=s2>&quot;input&quot;</span><span class=p>]:</span>
                        <span class=k>if</span> <span class=n>data</span><span class=p>[</span><span class=s2>&quot;input&quot;</span><span class=p>]</span> <span class=o>!=</span> <span class=nb>input</span><span class=p>:</span>
                            <span class=n>cmds</span><span class=o>.</span><span class=n>connectAttr</span><span class=p>(</span>
                                <span class=n>data</span><span class=p>[</span><span class=s2>&quot;input&quot;</span><span class=p>],</span> <span class=n>node_attr</span><span class=p>,</span> <span class=n>force</span><span class=o>=</span><span class=kc>True</span>
                            <span class=p>)</span>
                    <span class=k>else</span><span class=p>:</span>
                        <span class=k>if</span> <span class=nb>input</span><span class=p>:</span>
                            <span class=n>cmds</span><span class=o>.</span><span class=n>disconnectAttr</span><span class=p>(</span><span class=nb>input</span><span class=p>,</span> <span class=n>node_attr</span><span class=p>)</span>
                        <span class=n>cmds</span><span class=o>.</span><span class=n>setAttr</span><span class=p>(</span><span class=n>node_attr</span><span class=p>,</span> <span class=n>data</span><span class=p>[</span><span class=s2>&quot;value&quot;</span><span class=p>])</span>

        <span class=c1># Fix PLN-40 for older containers created with AYON that had the</span>
        <span class=c1># `.verticesOnlySet` set to True.</span>
        <span class=k>if</span> <span class=n>cmds</span><span class=o>.</span><span class=n>getAttr</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>{}</span><span class=s2>.verticesOnlySet&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>node</span><span class=p>)):</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Setting </span><span class=si>%s</span><span class=s2>.verticesOnlySet to False&quot;</span><span class=p>,</span> <span class=n>node</span><span class=p>)</span>
            <span class=n>cmds</span><span class=o>.</span><span class=n>setAttr</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>{}</span><span class=s2>.verticesOnlySet&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>node</span><span class=p>),</span> <span class=kc>False</span><span class=p>)</span>

        <span class=c1># Remove any placeHolderList attribute entries from the set that</span>
        <span class=c1># are remaining from nodes being removed from the referenced file.</span>
        <span class=n>members</span> <span class=o>=</span> <span class=n>cmds</span><span class=o>.</span><span class=n>sets</span><span class=p>(</span><span class=n>node</span><span class=p>,</span> <span class=n>query</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
        <span class=n>invalid</span> <span class=o>=</span> <span class=p>[</span><span class=n>x</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>members</span> <span class=k>if</span> <span class=s2>&quot;.placeHolderList&quot;</span> <span class=ow>in</span> <span class=n>x</span><span class=p>]</span>
        <span class=k>if</span> <span class=n>invalid</span><span class=p>:</span>
            <span class=n>cmds</span><span class=o>.</span><span class=n>sets</span><span class=p>(</span><span class=n>invalid</span><span class=p>,</span> <span class=n>remove</span><span class=o>=</span><span class=n>node</span><span class=p>)</span>

        <span class=c1># Update metadata</span>
        <span class=k>for</span> <span class=n>attr_name</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=p>[</span>
            <span class=p>(</span><span class=s2>&quot;representation&quot;</span><span class=p>,</span> <span class=n>repre_entity</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>]),</span>
            <span class=p>(</span><span class=s2>&quot;project_name&quot;</span><span class=p>,</span> <span class=n>context</span><span class=p>[</span><span class=s2>&quot;project&quot;</span><span class=p>][</span><span class=s2>&quot;name&quot;</span><span class=p>]),</span>
        <span class=p>]:</span>
            <span class=n>lib</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=n>node</span><span class=o>=</span><span class=n>node</span><span class=p>,</span> <span class=n>attribute</span><span class=o>=</span><span class=n>attr_name</span><span class=p>,</span> <span class=n>value</span><span class=o>=</span><span class=n>value</span><span class=p>)</span>

        <span class=c1># When an animation or pointcache gets connected to an Xgen container,</span>
        <span class=c1># the compound attribute &quot;xgenContainers&quot; gets created. When animation</span>
        <span class=c1># containers gets updated we also need to update the cacheFileName on</span>
        <span class=c1># the Xgen collection.</span>
        <span class=n>compound_name</span> <span class=o>=</span> <span class=s2>&quot;xgenContainers&quot;</span>
        <span class=k>if</span> <span class=n>cmds</span><span class=o>.</span><span class=n>objExists</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>{}</span><span class=s2>.</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>node</span><span class=p>,</span> <span class=n>compound_name</span><span class=p>)):</span>
            <span class=kn>import</span><span class=w> </span><span class=nn>xgenm</span>
            <span class=n>container_amount</span> <span class=o>=</span> <span class=n>cmds</span><span class=o>.</span><span class=n>getAttr</span><span class=p>(</span>
                <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>.</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>node</span><span class=p>,</span> <span class=n>compound_name</span><span class=p>),</span> <span class=n>size</span><span class=o>=</span><span class=kc>True</span>
            <span class=p>)</span>
            <span class=c1># loop through all compound children</span>
            <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>container_amount</span><span class=p>):</span>
                <span class=n>attr</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>.</span><span class=si>{}</span><span class=s2>[</span><span class=si>{}</span><span class=s2>].container&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>node</span><span class=p>,</span> <span class=n>compound_name</span><span class=p>,</span> <span class=n>i</span><span class=p>)</span>
                <span class=n>objectset</span> <span class=o>=</span> <span class=n>cmds</span><span class=o>.</span><span class=n>listConnections</span><span class=p>(</span><span class=n>attr</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
                <span class=n>reference_node</span> <span class=o>=</span> <span class=n>cmds</span><span class=o>.</span><span class=n>sets</span><span class=p>(</span><span class=n>objectset</span><span class=p>,</span> <span class=n>query</span><span class=o>=</span><span class=kc>True</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
                <span class=n>palettes</span> <span class=o>=</span> <span class=n>cmds</span><span class=o>.</span><span class=n>ls</span><span class=p>(</span>
                    <span class=n>cmds</span><span class=o>.</span><span class=n>referenceQuery</span><span class=p>(</span><span class=n>reference_node</span><span class=p>,</span> <span class=n>nodes</span><span class=o>=</span><span class=kc>True</span><span class=p>),</span>
                    <span class=nb>type</span><span class=o>=</span><span class=s2>&quot;xgmPalette&quot;</span>
                <span class=p>)</span>
                <span class=k>for</span> <span class=n>palette</span> <span class=ow>in</span> <span class=n>palettes</span><span class=p>:</span>
                    <span class=k>for</span> <span class=n>description</span> <span class=ow>in</span> <span class=n>xgenm</span><span class=o>.</span><span class=n>descriptions</span><span class=p>(</span><span class=n>palette</span><span class=p>):</span>
                        <span class=n>xgenm</span><span class=o>.</span><span class=n>setAttr</span><span class=p>(</span>
                            <span class=s2>&quot;cacheFileName&quot;</span><span class=p>,</span>
                            <span class=n>path</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\\</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;/&quot;</span><span class=p>),</span>
                            <span class=n>palette</span><span class=p>,</span>
                            <span class=n>description</span><span class=p>,</span>
                            <span class=s2>&quot;SplinePrimitive&quot;</span>
                        <span class=p>)</span>

            <span class=c1># Refresh UI and viewport.</span>
            <span class=n>de</span> <span class=o>=</span> <span class=n>xgenm</span><span class=o>.</span><span class=n>xgGlobal</span><span class=o>.</span><span class=n>DescriptionEditor</span>
            <span class=n>de</span><span class=o>.</span><span class=n>refresh</span><span class=p>(</span><span class=s2>&quot;Full&quot;</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>remove</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>container</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Remove an existing `container` from Maya scene</span>

<span class=sd>        Deprecated; this functionality is replaced by `api.remove()`</span>

<span class=sd>        Arguments:</span>
<span class=sd>            container (openpype:container-1.0): Which container</span>
<span class=sd>                to remove from scene.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=kn>from</span><span class=w> </span><span class=nn>maya</span><span class=w> </span><span class=kn>import</span> <span class=n>cmds</span>

        <span class=n>node</span> <span class=o>=</span> <span class=n>container</span><span class=p>[</span><span class=s2>&quot;objectName&quot;</span><span class=p>]</span>

        <span class=c1># Assume asset has been referenced</span>
        <span class=n>members</span> <span class=o>=</span> <span class=n>cmds</span><span class=o>.</span><span class=n>sets</span><span class=p>(</span><span class=n>node</span><span class=p>,</span> <span class=n>query</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
        <span class=n>reference_node</span> <span class=o>=</span> <span class=n>lib</span><span class=o>.</span><span class=n>get_reference_node</span><span class=p>(</span><span class=n>members</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=p>)</span>

        <span class=k>assert</span> <span class=n>reference_node</span><span class=p>,</span> <span class=p>(</span><span class=s2>&quot;Imported container not supported; &quot;</span>
                                <span class=s2>&quot;container must be referenced.&quot;</span><span class=p>)</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Removing &#39;</span><span class=si>%s</span><span class=s2>&#39; from Maya..&quot;</span> <span class=o>%</span> <span class=n>container</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>])</span>

        <span class=n>namespace</span> <span class=o>=</span> <span class=n>cmds</span><span class=o>.</span><span class=n>referenceQuery</span><span class=p>(</span><span class=n>reference_node</span><span class=p>,</span> <span class=n>namespace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
        <span class=n>fname</span> <span class=o>=</span> <span class=n>cmds</span><span class=o>.</span><span class=n>referenceQuery</span><span class=p>(</span><span class=n>reference_node</span><span class=p>,</span> <span class=n>filename</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
        <span class=n>cmds</span><span class=o>.</span><span class=n>file</span><span class=p>(</span><span class=n>fname</span><span class=p>,</span> <span class=n>removeReference</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

        <span class=k>try</span><span class=p>:</span>
            <span class=n>cmds</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>
        <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
            <span class=c1># Already implicitly deleted by Maya upon removing reference</span>
            <span class=k>pass</span>

        <span class=k>try</span><span class=p>:</span>
            <span class=c1># If container is not automatically cleaned up by May (issue #118)</span>
            <span class=n>cmds</span><span class=o>.</span><span class=n>namespace</span><span class=p>(</span><span class=n>removeNamespace</span><span class=o>=</span><span class=n>namespace</span><span class=p>,</span>
                           <span class=n>deleteNamespaceContent</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
        <span class=k>except</span> <span class=ne>RuntimeError</span><span class=p>:</span>
            <span class=k>pass</span>

    <span class=k>def</span><span class=w> </span><span class=nf>prepare_root_value</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_url</span><span class=p>,</span> <span class=n>project_name</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Replace root value with env var placeholder.</span>

<span class=sd>        Use ${AYON_PROJECT_ROOT_WORK} (or any other root) instead of proper</span>
<span class=sd>        root value when storing referenced url into a workfile.</span>
<span class=sd>        Useful for remote workflows with SiteSync.</span>

<span class=sd>        Args:</span>
<span class=sd>            file_url (str)</span>
<span class=sd>            project_name (dict)</span>
<span class=sd>        Returns:</span>
<span class=sd>            (str)</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>settings</span> <span class=o>=</span> <span class=n>get_project_settings</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>
        <span class=n>use_env_var_as_root</span> <span class=o>=</span> <span class=n>settings</span><span class=p>[</span><span class=s2>&quot;maya&quot;</span><span class=p>][</span><span class=s2>&quot;dirmap&quot;</span><span class=p>][</span><span class=s2>&quot;use_env_var_as_root&quot;</span><span class=p>]</span>
        <span class=k>if</span> <span class=n>use_env_var_as_root</span><span class=p>:</span>
            <span class=n>anatomy</span> <span class=o>=</span> <span class=n>Anatomy</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>
            <span class=n>file_url</span> <span class=o>=</span> <span class=n>anatomy</span><span class=o>.</span><span class=n>replace_root_with_env_key</span><span class=p>(</span><span class=n>file_url</span><span class=p>,</span> <span class=s1>&#39;${{</span><span class=si>{}</span><span class=s1>}}&#39;</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>file_url</span>

    <span class=nd>@staticmethod</span>
    <span class=k>def</span><span class=w> </span><span class=nf>_organize_containers</span><span class=p>(</span><span class=n>nodes</span><span class=p>,</span> <span class=n>container</span><span class=p>):</span>
        <span class=c1># type: (list, str) -&gt; None</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Put containers in loaded data to correct hierarchy.&quot;&quot;&quot;</span>
        <span class=k>for</span> <span class=n>node</span> <span class=ow>in</span> <span class=n>nodes</span><span class=p>:</span>
            <span class=n>id_attr</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>.id&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>cmds</span><span class=o>.</span><span class=n>attributeQuery</span><span class=p>(</span><span class=s2>&quot;id&quot;</span><span class=p>,</span> <span class=n>node</span><span class=o>=</span><span class=n>node</span><span class=p>,</span> <span class=n>exists</span><span class=o>=</span><span class=kc>True</span><span class=p>):</span>
                <span class=k>continue</span>
            <span class=k>if</span> <span class=n>cmds</span><span class=o>.</span><span class=n>getAttr</span><span class=p>(</span><span class=n>id_attr</span><span class=p>)</span> <span class=ow>not</span> <span class=ow>in</span> <span class=p>{</span>
                <span class=n>AYON_CONTAINER_ID</span><span class=p>,</span> <span class=n>AVALON_CONTAINER_ID</span>
            <span class=p>}:</span>
                <span class=n>cmds</span><span class=o>.</span><span class=n>sets</span><span class=p>(</span><span class=n>node</span><span class=p>,</span> <span class=n>forceElement</span><span class=o>=</span><span class=n>container</span><span class=p>)</span>

    <span class=nd>@classmethod</span>
    <span class=k>def</span><span class=w> </span><span class=nf>get_representation_name_aliases</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>representation_name</span><span class=p>):</span>
        <span class=c1># Allow switching between `ma` and `mb` representations if new</span>
        <span class=c1># version happens to contain only the other representation</span>
        <span class=k>return</span> <span class=p>{</span>
            <span class=s2>&quot;ma&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;mb&quot;</span><span class=p>],</span>
            <span class=s2>&quot;mb&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;ma&quot;</span><span class=p>]</span>
        <span class=p>}</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>representation_name</span><span class=p>,</span> <span class=p>[])</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h3 id=client.ayon_maya.api.plugin.ReferenceLoader.prepare_root_value class="doc doc-heading"> <code class="highlight language-python"><span class=n>prepare_root_value</span><span class=p>(</span><span class=n>file_url</span><span class=p>,</span> <span class=n>project_name</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Replace root value with env var placeholder.</p> <p>Use ${AYON_PROJECT_ROOT_WORK} (or any other root) instead of proper root value when storing referenced url into a workfile. Useful for remote workflows with SiteSync.</p> <p>Returns: (str)</p> <details class=quote> <summary>Source code in <code>client/ayon_maya/api/plugin.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1025</span>
<span class=normal>1026</span>
<span class=normal>1027</span>
<span class=normal>1028</span>
<span class=normal>1029</span>
<span class=normal>1030</span>
<span class=normal>1031</span>
<span class=normal>1032</span>
<span class=normal>1033</span>
<span class=normal>1034</span>
<span class=normal>1035</span>
<span class=normal>1036</span>
<span class=normal>1037</span>
<span class=normal>1038</span>
<span class=normal>1039</span>
<span class=normal>1040</span>
<span class=normal>1041</span>
<span class=normal>1042</span>
<span class=normal>1043</span>
<span class=normal>1044</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>prepare_root_value</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_url</span><span class=p>,</span> <span class=n>project_name</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Replace root value with env var placeholder.</span>

<span class=sd>    Use ${AYON_PROJECT_ROOT_WORK} (or any other root) instead of proper</span>
<span class=sd>    root value when storing referenced url into a workfile.</span>
<span class=sd>    Useful for remote workflows with SiteSync.</span>

<span class=sd>    Args:</span>
<span class=sd>        file_url (str)</span>
<span class=sd>        project_name (dict)</span>
<span class=sd>    Returns:</span>
<span class=sd>        (str)</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>settings</span> <span class=o>=</span> <span class=n>get_project_settings</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>
    <span class=n>use_env_var_as_root</span> <span class=o>=</span> <span class=n>settings</span><span class=p>[</span><span class=s2>&quot;maya&quot;</span><span class=p>][</span><span class=s2>&quot;dirmap&quot;</span><span class=p>][</span><span class=s2>&quot;use_env_var_as_root&quot;</span><span class=p>]</span>
    <span class=k>if</span> <span class=n>use_env_var_as_root</span><span class=p>:</span>
        <span class=n>anatomy</span> <span class=o>=</span> <span class=n>Anatomy</span><span class=p>(</span><span class=n>project_name</span><span class=p>)</span>
        <span class=n>file_url</span> <span class=o>=</span> <span class=n>anatomy</span><span class=o>.</span><span class=n>replace_root_with_env_key</span><span class=p>(</span><span class=n>file_url</span><span class=p>,</span> <span class=s1>&#39;${{</span><span class=si>{}</span><span class=s1>}}&#39;</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>file_url</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_maya.api.plugin.ReferenceLoader.process_reference class="doc doc-heading"> <code class="highlight language-python"><span class=n>process_reference</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>namespace</span><span class=p>,</span> <span class=n>options</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>To be implemented by subclass</p> <details class=quote> <summary>Source code in <code>client/ayon_maya/api/plugin.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>833</span>
<span class=normal>834</span>
<span class=normal>835</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>process_reference</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>context</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>namespace</span><span class=p>,</span> <span class=n>options</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;To be implemented by subclass&quot;&quot;&quot;</span>
    <span class=k>raise</span> <span class=ne>NotImplementedError</span><span class=p>(</span><span class=s2>&quot;Must be implemented by subclass&quot;</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_maya.api.plugin.ReferenceLoader.remove class="doc doc-heading"> <code class="highlight language-python"><span class=n>remove</span><span class=p>(</span><span class=n>container</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Remove an existing <code>container</code> from Maya scene</p> <p>Deprecated; this functionality is replaced by <code>api.remove()</code></p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>container</code> </td> <td> <code><span title=openpype>openpype</span></code> </td> <td> <div class=doc-md-description> <p>container-1.0): Which container to remove from scene.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_maya/api/plugin.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 985</span>
<span class=normal> 986</span>
<span class=normal> 987</span>
<span class=normal> 988</span>
<span class=normal> 989</span>
<span class=normal> 990</span>
<span class=normal> 991</span>
<span class=normal> 992</span>
<span class=normal> 993</span>
<span class=normal> 994</span>
<span class=normal> 995</span>
<span class=normal> 996</span>
<span class=normal> 997</span>
<span class=normal> 998</span>
<span class=normal> 999</span>
<span class=normal>1000</span>
<span class=normal>1001</span>
<span class=normal>1002</span>
<span class=normal>1003</span>
<span class=normal>1004</span>
<span class=normal>1005</span>
<span class=normal>1006</span>
<span class=normal>1007</span>
<span class=normal>1008</span>
<span class=normal>1009</span>
<span class=normal>1010</span>
<span class=normal>1011</span>
<span class=normal>1012</span>
<span class=normal>1013</span>
<span class=normal>1014</span>
<span class=normal>1015</span>
<span class=normal>1016</span>
<span class=normal>1017</span>
<span class=normal>1018</span>
<span class=normal>1019</span>
<span class=normal>1020</span>
<span class=normal>1021</span>
<span class=normal>1022</span>
<span class=normal>1023</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>remove</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>container</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Remove an existing `container` from Maya scene</span>

<span class=sd>    Deprecated; this functionality is replaced by `api.remove()`</span>

<span class=sd>    Arguments:</span>
<span class=sd>        container (openpype:container-1.0): Which container</span>
<span class=sd>            to remove from scene.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=kn>from</span><span class=w> </span><span class=nn>maya</span><span class=w> </span><span class=kn>import</span> <span class=n>cmds</span>

    <span class=n>node</span> <span class=o>=</span> <span class=n>container</span><span class=p>[</span><span class=s2>&quot;objectName&quot;</span><span class=p>]</span>

    <span class=c1># Assume asset has been referenced</span>
    <span class=n>members</span> <span class=o>=</span> <span class=n>cmds</span><span class=o>.</span><span class=n>sets</span><span class=p>(</span><span class=n>node</span><span class=p>,</span> <span class=n>query</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
    <span class=n>reference_node</span> <span class=o>=</span> <span class=n>lib</span><span class=o>.</span><span class=n>get_reference_node</span><span class=p>(</span><span class=n>members</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=p>)</span>

    <span class=k>assert</span> <span class=n>reference_node</span><span class=p>,</span> <span class=p>(</span><span class=s2>&quot;Imported container not supported; &quot;</span>
                            <span class=s2>&quot;container must be referenced.&quot;</span><span class=p>)</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Removing &#39;</span><span class=si>%s</span><span class=s2>&#39; from Maya..&quot;</span> <span class=o>%</span> <span class=n>container</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>])</span>

    <span class=n>namespace</span> <span class=o>=</span> <span class=n>cmds</span><span class=o>.</span><span class=n>referenceQuery</span><span class=p>(</span><span class=n>reference_node</span><span class=p>,</span> <span class=n>namespace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
    <span class=n>fname</span> <span class=o>=</span> <span class=n>cmds</span><span class=o>.</span><span class=n>referenceQuery</span><span class=p>(</span><span class=n>reference_node</span><span class=p>,</span> <span class=n>filename</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
    <span class=n>cmds</span><span class=o>.</span><span class=n>file</span><span class=p>(</span><span class=n>fname</span><span class=p>,</span> <span class=n>removeReference</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

    <span class=k>try</span><span class=p>:</span>
        <span class=n>cmds</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>
    <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
        <span class=c1># Already implicitly deleted by Maya upon removing reference</span>
        <span class=k>pass</span>

    <span class=k>try</span><span class=p>:</span>
        <span class=c1># If container is not automatically cleaned up by May (issue #118)</span>
        <span class=n>cmds</span><span class=o>.</span><span class=n>namespace</span><span class=p>(</span><span class=n>removeNamespace</span><span class=o>=</span><span class=n>namespace</span><span class=p>,</span>
                       <span class=n>deleteNamespaceContent</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
    <span class=k>except</span> <span class=ne>RuntimeError</span><span class=p>:</span>
        <span class=k>pass</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h2 id=client.ayon_maya.api.plugin.RenderlayerCreator class="doc doc-heading"> <code>RenderlayerCreator</code> </h2> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=ayon_core.pipeline.Creator>Creator</span></code>, <code><a class="autorefs autorefs-internal" title="MayaCreatorBase (client.ayon_maya.api.plugin.MayaCreatorBase)" href=#client.ayon_maya.api.plugin.MayaCreatorBase>MayaCreatorBase</a></code></p> <p>Creator which creates an instance per renderlayer in the workfile.</p> <p>Create and manages renderlayer product per renderLayer in workfile. This generates a singleton node in the scene which, if it exists, tells the Creator to collect Maya rendersetup renderlayers as individual instances. As such, triggering create doesn't actually create the instance node per layer but only the node which tells the Creator it may now collect an instance per renderlayer.</p> <details class=quote> <summary>Source code in <code>client/ayon_maya/api/plugin.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>404</span>
<span class=normal>405</span>
<span class=normal>406</span>
<span class=normal>407</span>
<span class=normal>408</span>
<span class=normal>409</span>
<span class=normal>410</span>
<span class=normal>411</span>
<span class=normal>412</span>
<span class=normal>413</span>
<span class=normal>414</span>
<span class=normal>415</span>
<span class=normal>416</span>
<span class=normal>417</span>
<span class=normal>418</span>
<span class=normal>419</span>
<span class=normal>420</span>
<span class=normal>421</span>
<span class=normal>422</span>
<span class=normal>423</span>
<span class=normal>424</span>
<span class=normal>425</span>
<span class=normal>426</span>
<span class=normal>427</span>
<span class=normal>428</span>
<span class=normal>429</span>
<span class=normal>430</span>
<span class=normal>431</span>
<span class=normal>432</span>
<span class=normal>433</span>
<span class=normal>434</span>
<span class=normal>435</span>
<span class=normal>436</span>
<span class=normal>437</span>
<span class=normal>438</span>
<span class=normal>439</span>
<span class=normal>440</span>
<span class=normal>441</span>
<span class=normal>442</span>
<span class=normal>443</span>
<span class=normal>444</span>
<span class=normal>445</span>
<span class=normal>446</span>
<span class=normal>447</span>
<span class=normal>448</span>
<span class=normal>449</span>
<span class=normal>450</span>
<span class=normal>451</span>
<span class=normal>452</span>
<span class=normal>453</span>
<span class=normal>454</span>
<span class=normal>455</span>
<span class=normal>456</span>
<span class=normal>457</span>
<span class=normal>458</span>
<span class=normal>459</span>
<span class=normal>460</span>
<span class=normal>461</span>
<span class=normal>462</span>
<span class=normal>463</span>
<span class=normal>464</span>
<span class=normal>465</span>
<span class=normal>466</span>
<span class=normal>467</span>
<span class=normal>468</span>
<span class=normal>469</span>
<span class=normal>470</span>
<span class=normal>471</span>
<span class=normal>472</span>
<span class=normal>473</span>
<span class=normal>474</span>
<span class=normal>475</span>
<span class=normal>476</span>
<span class=normal>477</span>
<span class=normal>478</span>
<span class=normal>479</span>
<span class=normal>480</span>
<span class=normal>481</span>
<span class=normal>482</span>
<span class=normal>483</span>
<span class=normal>484</span>
<span class=normal>485</span>
<span class=normal>486</span>
<span class=normal>487</span>
<span class=normal>488</span>
<span class=normal>489</span>
<span class=normal>490</span>
<span class=normal>491</span>
<span class=normal>492</span>
<span class=normal>493</span>
<span class=normal>494</span>
<span class=normal>495</span>
<span class=normal>496</span>
<span class=normal>497</span>
<span class=normal>498</span>
<span class=normal>499</span>
<span class=normal>500</span>
<span class=normal>501</span>
<span class=normal>502</span>
<span class=normal>503</span>
<span class=normal>504</span>
<span class=normal>505</span>
<span class=normal>506</span>
<span class=normal>507</span>
<span class=normal>508</span>
<span class=normal>509</span>
<span class=normal>510</span>
<span class=normal>511</span>
<span class=normal>512</span>
<span class=normal>513</span>
<span class=normal>514</span>
<span class=normal>515</span>
<span class=normal>516</span>
<span class=normal>517</span>
<span class=normal>518</span>
<span class=normal>519</span>
<span class=normal>520</span>
<span class=normal>521</span>
<span class=normal>522</span>
<span class=normal>523</span>
<span class=normal>524</span>
<span class=normal>525</span>
<span class=normal>526</span>
<span class=normal>527</span>
<span class=normal>528</span>
<span class=normal>529</span>
<span class=normal>530</span>
<span class=normal>531</span>
<span class=normal>532</span>
<span class=normal>533</span>
<span class=normal>534</span>
<span class=normal>535</span>
<span class=normal>536</span>
<span class=normal>537</span>
<span class=normal>538</span>
<span class=normal>539</span>
<span class=normal>540</span>
<span class=normal>541</span>
<span class=normal>542</span>
<span class=normal>543</span>
<span class=normal>544</span>
<span class=normal>545</span>
<span class=normal>546</span>
<span class=normal>547</span>
<span class=normal>548</span>
<span class=normal>549</span>
<span class=normal>550</span>
<span class=normal>551</span>
<span class=normal>552</span>
<span class=normal>553</span>
<span class=normal>554</span>
<span class=normal>555</span>
<span class=normal>556</span>
<span class=normal>557</span>
<span class=normal>558</span>
<span class=normal>559</span>
<span class=normal>560</span>
<span class=normal>561</span>
<span class=normal>562</span>
<span class=normal>563</span>
<span class=normal>564</span>
<span class=normal>565</span>
<span class=normal>566</span>
<span class=normal>567</span>
<span class=normal>568</span>
<span class=normal>569</span>
<span class=normal>570</span>
<span class=normal>571</span>
<span class=normal>572</span>
<span class=normal>573</span>
<span class=normal>574</span>
<span class=normal>575</span>
<span class=normal>576</span>
<span class=normal>577</span>
<span class=normal>578</span>
<span class=normal>579</span>
<span class=normal>580</span>
<span class=normal>581</span>
<span class=normal>582</span>
<span class=normal>583</span>
<span class=normal>584</span>
<span class=normal>585</span>
<span class=normal>586</span>
<span class=normal>587</span>
<span class=normal>588</span>
<span class=normal>589</span>
<span class=normal>590</span>
<span class=normal>591</span>
<span class=normal>592</span>
<span class=normal>593</span>
<span class=normal>594</span>
<span class=normal>595</span>
<span class=normal>596</span>
<span class=normal>597</span>
<span class=normal>598</span>
<span class=normal>599</span>
<span class=normal>600</span>
<span class=normal>601</span>
<span class=normal>602</span>
<span class=normal>603</span>
<span class=normal>604</span>
<span class=normal>605</span>
<span class=normal>606</span>
<span class=normal>607</span>
<span class=normal>608</span>
<span class=normal>609</span>
<span class=normal>610</span>
<span class=normal>611</span>
<span class=normal>612</span>
<span class=normal>613</span>
<span class=normal>614</span>
<span class=normal>615</span>
<span class=normal>616</span>
<span class=normal>617</span>
<span class=normal>618</span>
<span class=normal>619</span>
<span class=normal>620</span>
<span class=normal>621</span>
<span class=normal>622</span>
<span class=normal>623</span>
<span class=normal>624</span>
<span class=normal>625</span>
<span class=normal>626</span>
<span class=normal>627</span>
<span class=normal>628</span>
<span class=normal>629</span>
<span class=normal>630</span>
<span class=normal>631</span>
<span class=normal>632</span>
<span class=normal>633</span>
<span class=normal>634</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>RenderlayerCreator</span><span class=p>(</span><span class=n>Creator</span><span class=p>,</span> <span class=n>MayaCreatorBase</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Creator which creates an instance per renderlayer in the workfile.</span>

<span class=sd>    Create and manages renderlayer product per renderLayer in workfile.</span>
<span class=sd>    This generates a singleton node in the scene which, if it exists, tells the</span>
<span class=sd>    Creator to collect Maya rendersetup renderlayers as individual instances.</span>
<span class=sd>    As such, triggering create doesn&#39;t actually create the instance node per</span>
<span class=sd>    layer but only the node which tells the Creator it may now collect</span>
<span class=sd>    an instance per renderlayer.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>settings_category</span> <span class=o>=</span> <span class=s2>&quot;maya&quot;</span>
    <span class=c1># These are required to be overridden in subclass</span>
    <span class=n>singleton_node_name</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>

    <span class=c1># These are optional to be overridden in subclass</span>
    <span class=n>layer_instance_prefix</span> <span class=o>=</span> <span class=kc>None</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_get_singleton_node</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>return_all</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
        <span class=n>nodes</span> <span class=o>=</span> <span class=n>lib</span><span class=o>.</span><span class=n>lsattr</span><span class=p>(</span><span class=s2>&quot;pre_creator_identifier&quot;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>identifier</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>nodes</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>nodes</span> <span class=k>if</span> <span class=n>return_all</span> <span class=k>else</span> <span class=n>nodes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>

    <span class=k>def</span><span class=w> </span><span class=nf>create</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>product_name</span><span class=p>,</span> <span class=n>instance_data</span><span class=p>,</span> <span class=n>pre_create_data</span><span class=p>):</span>
        <span class=c1># A Renderlayer is never explicitly created using the create method.</span>
        <span class=c1># Instead, renderlayers from the scene are collected. Thus &quot;create&quot;</span>
        <span class=c1># would only ever be called to say, &#39;hey, please refresh collect&#39;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>create_singleton_node</span><span class=p>()</span>

        <span class=c1># if no render layers are present, create default one with</span>
        <span class=c1># asterisk selector</span>
        <span class=n>rs</span> <span class=o>=</span> <span class=n>renderSetup</span><span class=o>.</span><span class=n>instance</span><span class=p>()</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>rs</span><span class=o>.</span><span class=n>getRenderLayers</span><span class=p>():</span>
            <span class=n>render_layer</span> <span class=o>=</span> <span class=n>rs</span><span class=o>.</span><span class=n>createRenderLayer</span><span class=p>(</span><span class=s2>&quot;Main&quot;</span><span class=p>)</span>
            <span class=n>collection</span> <span class=o>=</span> <span class=n>render_layer</span><span class=o>.</span><span class=n>createCollection</span><span class=p>(</span><span class=s2>&quot;defaultCollection&quot;</span><span class=p>)</span>
            <span class=n>collection</span><span class=o>.</span><span class=n>getSelector</span><span class=p>()</span><span class=o>.</span><span class=n>setPattern</span><span class=p>(</span><span class=s1>&#39;*&#39;</span><span class=p>)</span>

        <span class=c1># By RenderLayerCreator.create we make it so that the renderlayer</span>
        <span class=c1># instances directly appear even though it just collects scene</span>
        <span class=c1># renderlayers. This doesn&#39;t actually &#39;create&#39; any scene contents.</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>collect_instances</span><span class=p>()</span>

    <span class=k>def</span><span class=w> </span><span class=nf>create_singleton_node</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_singleton_node</span><span class=p>():</span>
            <span class=k>raise</span> <span class=n>CreatorError</span><span class=p>(</span><span class=s2>&quot;A Render instance already exists - only &quot;</span>
                               <span class=s2>&quot;one can be configured.&quot;</span><span class=p>)</span>

        <span class=k>with</span> <span class=n>lib</span><span class=o>.</span><span class=n>undo_chunk</span><span class=p>():</span>
            <span class=n>node</span> <span class=o>=</span> <span class=n>cmds</span><span class=o>.</span><span class=n>sets</span><span class=p>(</span><span class=n>empty</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>singleton_node_name</span><span class=p>)</span>
            <span class=n>lib</span><span class=o>.</span><span class=n>imprint</span><span class=p>(</span><span class=n>node</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=p>{</span>
                <span class=s2>&quot;pre_creator_identifier&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>identifier</span>
            <span class=p>})</span>

        <span class=k>return</span> <span class=n>node</span>

    <span class=k>def</span><span class=w> </span><span class=nf>collect_instances</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>

        <span class=c1># We only collect if the global render instance exists</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_singleton_node</span><span class=p>():</span>
            <span class=k>return</span>

        <span class=n>host_name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>create_context</span><span class=o>.</span><span class=n>host_name</span>
        <span class=n>rs</span> <span class=o>=</span> <span class=n>renderSetup</span><span class=o>.</span><span class=n>instance</span><span class=p>()</span>
        <span class=n>layers</span> <span class=o>=</span> <span class=n>rs</span><span class=o>.</span><span class=n>getRenderLayers</span><span class=p>()</span>
        <span class=k>for</span> <span class=n>layer</span> <span class=ow>in</span> <span class=n>layers</span><span class=p>:</span>
            <span class=n>layer_instance_node</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>find_layer_instance_node</span><span class=p>(</span><span class=n>layer</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>layer_instance_node</span><span class=p>:</span>
                <span class=n>data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>read_instance_node</span><span class=p>(</span><span class=n>layer_instance_node</span><span class=p>)</span>
                <span class=n>instance</span> <span class=o>=</span> <span class=n>CreatedInstance</span><span class=o>.</span><span class=n>from_existing</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>creator</span><span class=o>=</span><span class=bp>self</span><span class=p>)</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=c1># No existing scene instance node for this layer. Note that</span>
                <span class=c1># this instance will not have the `instance_node` data yet</span>
                <span class=c1># until it&#39;s been saved/persisted at least once.</span>
                <span class=n>project_name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>create_context</span><span class=o>.</span><span class=n>get_current_project_name</span><span class=p>()</span>
                <span class=n>folder_entity</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>create_context</span><span class=o>.</span><span class=n>get_current_folder_entity</span><span class=p>()</span>
                <span class=n>folder_path</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>folder_entity</span><span class=p>[</span><span class=s2>&quot;path&quot;</span><span class=p>]</span>
                <span class=n>task_entity</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>create_context</span><span class=o>.</span><span class=n>get_current_task_entity</span><span class=p>()</span>
                <span class=n>task_name</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>task_entity</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]</span>
                <span class=n>instance_data</span> <span class=o>=</span> <span class=p>{</span>
                    <span class=s2>&quot;folderPath&quot;</span><span class=p>:</span> <span class=n>folder_path</span><span class=p>,</span>
                    <span class=s2>&quot;task&quot;</span><span class=p>:</span> <span class=n>task_name</span><span class=p>,</span>
                    <span class=s2>&quot;variant&quot;</span><span class=p>:</span> <span class=n>layer</span><span class=o>.</span><span class=n>name</span><span class=p>(),</span>
                <span class=p>}</span>
                <span class=n>product_name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_product_name</span><span class=p>(</span>
                    <span class=n>project_name</span><span class=p>,</span>
                    <span class=n>folder_entity</span><span class=p>,</span>
                    <span class=n>task_entity</span><span class=p>,</span>
                    <span class=n>layer</span><span class=o>.</span><span class=n>name</span><span class=p>(),</span>
                    <span class=n>host_name</span><span class=p>,</span>
                <span class=p>)</span>

                <span class=n>instance</span> <span class=o>=</span> <span class=n>CreatedInstance</span><span class=p>(</span>
                    <span class=n>product_type</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>product_type</span><span class=p>,</span>
                    <span class=n>product_name</span><span class=o>=</span><span class=n>product_name</span><span class=p>,</span>
                    <span class=n>data</span><span class=o>=</span><span class=n>instance_data</span><span class=p>,</span>
                    <span class=n>creator</span><span class=o>=</span><span class=bp>self</span>
                <span class=p>)</span>

            <span class=n>instance</span><span class=o>.</span><span class=n>transient_data</span><span class=p>[</span><span class=s2>&quot;layer&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>layer</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_add_instance_to_context</span><span class=p>(</span><span class=n>instance</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>find_layer_instance_node</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>layer</span><span class=p>):</span>
        <span class=n>connected_sets</span> <span class=o>=</span> <span class=n>cmds</span><span class=o>.</span><span class=n>listConnections</span><span class=p>(</span>
            <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>.message&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>layer</span><span class=o>.</span><span class=n>name</span><span class=p>()),</span>
            <span class=n>source</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
            <span class=n>destination</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
            <span class=nb>type</span><span class=o>=</span><span class=s2>&quot;objectSet&quot;</span>
        <span class=p>)</span> <span class=ow>or</span> <span class=p>[]</span>

        <span class=k>for</span> <span class=n>node</span> <span class=ow>in</span> <span class=n>connected_sets</span><span class=p>:</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>cmds</span><span class=o>.</span><span class=n>attributeQuery</span><span class=p>(</span><span class=s2>&quot;creator_identifier&quot;</span><span class=p>,</span>
                                       <span class=n>node</span><span class=o>=</span><span class=n>node</span><span class=p>,</span>
                                       <span class=n>exists</span><span class=o>=</span><span class=kc>True</span><span class=p>):</span>
                <span class=k>continue</span>

            <span class=n>creator_identifier</span> <span class=o>=</span> <span class=n>cmds</span><span class=o>.</span><span class=n>getAttr</span><span class=p>(</span><span class=n>node</span> <span class=o>+</span> <span class=s2>&quot;.creator_identifier&quot;</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>creator_identifier</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>identifier</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Found node: </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>node</span><span class=p>))</span>
                <span class=k>return</span> <span class=n>node</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_create_layer_instance_node</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>layer</span><span class=p>):</span>

        <span class=c1># We only collect if a CreateRender instance exists</span>
        <span class=n>create_render_set</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_singleton_node</span><span class=p>()</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>create_render_set</span><span class=p>:</span>
            <span class=k>raise</span> <span class=n>CreatorError</span><span class=p>(</span><span class=s2>&quot;Creating a renderlayer instance node is not &quot;</span>
                               <span class=s2>&quot;allowed if no &#39;CreateRender&#39; instance exists&quot;</span><span class=p>)</span>

        <span class=n>namespace</span> <span class=o>=</span> <span class=s2>&quot;_</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>singleton_node_name</span><span class=p>)</span>
        <span class=n>namespace</span> <span class=o>=</span> <span class=n>ensure_namespace</span><span class=p>(</span><span class=n>namespace</span><span class=p>)</span>

        <span class=n>name</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>:</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>namespace</span><span class=p>,</span> <span class=n>layer</span><span class=o>.</span><span class=n>name</span><span class=p>())</span>
        <span class=n>render_set</span> <span class=o>=</span> <span class=n>cmds</span><span class=o>.</span><span class=n>sets</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=n>name</span><span class=p>,</span> <span class=n>empty</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

        <span class=c1># Keep an active link with the renderlayer so we can retrieve it</span>
        <span class=c1># later by a physical maya connection instead of relying on the layer</span>
        <span class=c1># name</span>
        <span class=n>cmds</span><span class=o>.</span><span class=n>addAttr</span><span class=p>(</span><span class=n>render_set</span><span class=p>,</span> <span class=n>longName</span><span class=o>=</span><span class=s2>&quot;renderlayer&quot;</span><span class=p>,</span> <span class=n>at</span><span class=o>=</span><span class=s2>&quot;message&quot;</span><span class=p>)</span>
        <span class=n>cmds</span><span class=o>.</span><span class=n>connectAttr</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>{}</span><span class=s2>.message&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>layer</span><span class=o>.</span><span class=n>name</span><span class=p>()),</span>
                         <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>.renderlayer&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>render_set</span><span class=p>),</span> <span class=n>force</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

        <span class=c1># Add the set to the &#39;CreateRender&#39; set.</span>
        <span class=n>cmds</span><span class=o>.</span><span class=n>sets</span><span class=p>(</span><span class=n>render_set</span><span class=p>,</span> <span class=n>forceElement</span><span class=o>=</span><span class=n>create_render_set</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>render_set</span>

    <span class=k>def</span><span class=w> </span><span class=nf>update_instances</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>update_list</span><span class=p>):</span>
        <span class=c1># We only generate the persisting layer data into the scene once</span>
        <span class=c1># we save with the UI on e.g. validate or publish</span>
        <span class=k>for</span> <span class=n>instance</span><span class=p>,</span> <span class=n>_changes</span> <span class=ow>in</span> <span class=n>update_list</span><span class=p>:</span>
            <span class=n>instance_node</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;instance_node&quot;</span><span class=p>)</span>

            <span class=c1># Ensure a node exists to persist the data to</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>instance_node</span><span class=p>:</span>
                <span class=n>layer</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>transient_data</span><span class=p>[</span><span class=s2>&quot;layer&quot;</span><span class=p>]</span>
                <span class=n>instance_node</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_create_layer_instance_node</span><span class=p>(</span><span class=n>layer</span><span class=p>)</span>
                <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;instance_node&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>instance_node</span>

            <span class=bp>self</span><span class=o>.</span><span class=n>imprint_instance_node</span><span class=p>(</span><span class=n>instance_node</span><span class=p>,</span>
                                       <span class=n>data</span><span class=o>=</span><span class=n>instance</span><span class=o>.</span><span class=n>data_to_store</span><span class=p>())</span>

    <span class=k>def</span><span class=w> </span><span class=nf>imprint_instance_node</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>node</span><span class=p>,</span> <span class=n>data</span><span class=p>):</span>
        <span class=c1># Do not ever try to update the `renderlayer` since it&#39;ll try</span>
        <span class=c1># to remove the attribute and recreate it but fail to keep it a</span>
        <span class=c1># message attribute link. We only ever imprint that on the initial</span>
        <span class=c1># node creation.</span>
        <span class=c1># TODO: Improve how this is handled</span>
        <span class=n>data</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;renderlayer&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
        <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;creator_attributes&quot;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;renderlayer&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>

        <span class=k>return</span> <span class=nb>super</span><span class=p>(</span><span class=n>RenderlayerCreator</span><span class=p>,</span> <span class=bp>self</span><span class=p>)</span><span class=o>.</span><span class=n>imprint_instance_node</span><span class=p>(</span><span class=n>node</span><span class=p>,</span>
                                                                     <span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>remove_instances</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>instances</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Remove specified instances from the scene.</span>

<span class=sd>        This is only removing `id` parameter so instance is no longer</span>
<span class=sd>        instance, because it might contain valuable data for artist.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=c1># Instead of removing the single instance or renderlayers we instead</span>
        <span class=c1># remove the CreateRender node this creator relies on to decide whether</span>
        <span class=c1># it should collect anything at all.</span>
        <span class=n>nodes</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_singleton_node</span><span class=p>(</span><span class=n>return_all</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>nodes</span><span class=p>:</span>
            <span class=n>cmds</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=n>nodes</span><span class=p>)</span>

        <span class=c1># Remove ALL the instances even if only one gets deleted</span>
        <span class=k>for</span> <span class=n>instance</span> <span class=ow>in</span> <span class=nb>list</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>create_context</span><span class=o>.</span><span class=n>instances</span><span class=p>):</span>
            <span class=k>if</span> <span class=n>instance</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;creator_identifier&quot;</span><span class=p>)</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>identifier</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_remove_instance_from_context</span><span class=p>(</span><span class=n>instance</span><span class=p>)</span>

                <span class=c1># Remove the stored settings per renderlayer too</span>
                <span class=n>node</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;instance_node&quot;</span><span class=p>)</span>
                <span class=k>if</span> <span class=n>node</span> <span class=ow>and</span> <span class=n>cmds</span><span class=o>.</span><span class=n>objExists</span><span class=p>(</span><span class=n>node</span><span class=p>):</span>
                    <span class=n>cmds</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_product_name</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>project_name</span><span class=p>,</span>
        <span class=n>folder_entity</span><span class=p>,</span>
        <span class=n>task_entity</span><span class=p>,</span>
        <span class=n>variant</span><span class=p>,</span>
        <span class=n>host_name</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
        <span class=n>instance</span><span class=o>=</span><span class=kc>None</span>
    <span class=p>):</span>
        <span class=k>if</span> <span class=n>host_name</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>host_name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>create_context</span><span class=o>.</span><span class=n>host_name</span>
        <span class=n>dynamic_data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_dynamic_data</span><span class=p>(</span>
            <span class=n>project_name</span><span class=p>,</span>
            <span class=n>folder_entity</span><span class=p>,</span>
            <span class=n>task_entity</span><span class=p>,</span>
            <span class=n>variant</span><span class=p>,</span>
            <span class=n>host_name</span><span class=p>,</span>
            <span class=n>instance</span>
        <span class=p>)</span>
        <span class=n>task_name</span> <span class=o>=</span> <span class=n>task_type</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=k>if</span> <span class=n>task_entity</span><span class=p>:</span>
            <span class=n>task_name</span> <span class=o>=</span> <span class=n>task_entity</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]</span>
            <span class=n>task_type</span> <span class=o>=</span> <span class=n>task_entity</span><span class=p>[</span><span class=s2>&quot;taskType&quot;</span><span class=p>]</span>
        <span class=c1># creator.product_type != &#39;render&#39; as expected</span>
        <span class=k>return</span> <span class=n>get_product_name</span><span class=p>(</span>
            <span class=n>project_name</span><span class=p>,</span>
            <span class=n>task_name</span><span class=p>,</span>
            <span class=n>task_type</span><span class=p>,</span>
            <span class=n>host_name</span><span class=p>,</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>layer_instance_prefix</span> <span class=ow>or</span> <span class=bp>self</span><span class=o>.</span><span class=n>product_type</span><span class=p>,</span>
            <span class=n>variant</span><span class=p>,</span>
            <span class=n>dynamic_data</span><span class=o>=</span><span class=n>dynamic_data</span><span class=p>,</span>
            <span class=n>project_settings</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>project_settings</span>
        <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h3 id=client.ayon_maya.api.plugin.RenderlayerCreator.remove_instances class="doc doc-heading"> <code class="highlight language-python"><span class=n>remove_instances</span><span class=p>(</span><span class=n>instances</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Remove specified instances from the scene.</p> <p>This is only removing <code>id</code> parameter so instance is no longer instance, because it might contain valuable data for artist.</p> <details class=quote> <summary>Source code in <code>client/ayon_maya/api/plugin.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>577</span>
<span class=normal>578</span>
<span class=normal>579</span>
<span class=normal>580</span>
<span class=normal>581</span>
<span class=normal>582</span>
<span class=normal>583</span>
<span class=normal>584</span>
<span class=normal>585</span>
<span class=normal>586</span>
<span class=normal>587</span>
<span class=normal>588</span>
<span class=normal>589</span>
<span class=normal>590</span>
<span class=normal>591</span>
<span class=normal>592</span>
<span class=normal>593</span>
<span class=normal>594</span>
<span class=normal>595</span>
<span class=normal>596</span>
<span class=normal>597</span>
<span class=normal>598</span>
<span class=normal>599</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>remove_instances</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>instances</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Remove specified instances from the scene.</span>

<span class=sd>    This is only removing `id` parameter so instance is no longer</span>
<span class=sd>    instance, because it might contain valuable data for artist.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=c1># Instead of removing the single instance or renderlayers we instead</span>
    <span class=c1># remove the CreateRender node this creator relies on to decide whether</span>
    <span class=c1># it should collect anything at all.</span>
    <span class=n>nodes</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_singleton_node</span><span class=p>(</span><span class=n>return_all</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>nodes</span><span class=p>:</span>
        <span class=n>cmds</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=n>nodes</span><span class=p>)</span>

    <span class=c1># Remove ALL the instances even if only one gets deleted</span>
    <span class=k>for</span> <span class=n>instance</span> <span class=ow>in</span> <span class=nb>list</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>create_context</span><span class=o>.</span><span class=n>instances</span><span class=p>):</span>
        <span class=k>if</span> <span class=n>instance</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;creator_identifier&quot;</span><span class=p>)</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>identifier</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_remove_instance_from_context</span><span class=p>(</span><span class=n>instance</span><span class=p>)</span>

            <span class=c1># Remove the stored settings per renderlayer too</span>
            <span class=n>node</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;instance_node&quot;</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>node</span> <span class=ow>and</span> <span class=n>cmds</span><span class=o>.</span><span class=n>objExists</span><span class=p>(</span><span class=n>node</span><span class=p>):</span>
                <span class=n>cmds</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-function"> <h2 id=client.ayon_maya.api.plugin.ensure_namespace class="doc doc-heading"> <code class="highlight language-python"><span class=n>ensure_namespace</span><span class=p>(</span><span class=n>namespace</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Make sure the namespace exists.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>namespace</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>The preferred namespace name.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>str</code></td> <td> </td> <td> <div class=doc-md-description> <p>The generated or existing namespace</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_maya/api/plugin.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>387</span>
<span class=normal>388</span>
<span class=normal>389</span>
<span class=normal>390</span>
<span class=normal>391</span>
<span class=normal>392</span>
<span class=normal>393</span>
<span class=normal>394</span>
<span class=normal>395</span>
<span class=normal>396</span>
<span class=normal>397</span>
<span class=normal>398</span>
<span class=normal>399</span>
<span class=normal>400</span>
<span class=normal>401</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>ensure_namespace</span><span class=p>(</span><span class=n>namespace</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Make sure the namespace exists.</span>

<span class=sd>    Args:</span>
<span class=sd>        namespace (str): The preferred namespace name.</span>

<span class=sd>    Returns:</span>
<span class=sd>        str: The generated or existing namespace</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>exists</span> <span class=o>=</span> <span class=n>cmds</span><span class=o>.</span><span class=n>namespace</span><span class=p>(</span><span class=n>exists</span><span class=o>=</span><span class=n>namespace</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>exists</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>namespace</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>cmds</span><span class=o>.</span><span class=n>namespace</span><span class=p>(</span><span class=n>add</span><span class=o>=</span><span class=n>namespace</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=client.ayon_maya.api.plugin.get_ayon_entity_uri_from_representation_context class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_ayon_entity_uri_from_representation_context</span><span class=p>(</span><span class=n>context</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Resolve AYON Entity URI from representation context.</p> <details class=note open> <summary>Note</summary> <p>The representation context is the <code>get_representation_context</code> dict containing the <code>project</code>, <code>folder,</code>representation<code>and so forth. It is not the representation entity</code>context` key.</p> </details> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>context</code> </td> <td> <code><span title=dict>dict</span></code> </td> <td> <div class=doc-md-description> <p>The representation context.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=RuntimeError>RuntimeError</span></code> </td> <td> <div class=doc-md-description> <p>Unable to resolve to a single valid URI.</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>str</code></td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>The AYON entity URI.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_maya/api/plugin.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 70</span>
<span class=normal> 71</span>
<span class=normal> 72</span>
<span class=normal> 73</span>
<span class=normal> 74</span>
<span class=normal> 75</span>
<span class=normal> 76</span>
<span class=normal> 77</span>
<span class=normal> 78</span>
<span class=normal> 79</span>
<span class=normal> 80</span>
<span class=normal> 81</span>
<span class=normal> 82</span>
<span class=normal> 83</span>
<span class=normal> 84</span>
<span class=normal> 85</span>
<span class=normal> 86</span>
<span class=normal> 87</span>
<span class=normal> 88</span>
<span class=normal> 89</span>
<span class=normal> 90</span>
<span class=normal> 91</span>
<span class=normal> 92</span>
<span class=normal> 93</span>
<span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_ayon_entity_uri_from_representation_context</span><span class=p>(</span><span class=n>context</span><span class=p>:</span> <span class=nb>dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Resolve AYON Entity URI from representation context.</span>

<span class=sd>    Note:</span>
<span class=sd>        The representation context is the `get_representation_context` dict</span>
<span class=sd>        containing the `project`, `folder, `representation` and so forth.</span>
<span class=sd>        It is not the representation entity `context` key.</span>

<span class=sd>    Arguments:</span>
<span class=sd>        context (dict): The representation context.</span>

<span class=sd>    Raises:</span>
<span class=sd>        RuntimeError: Unable to resolve to a single valid URI.</span>

<span class=sd>    Returns:</span>
<span class=sd>        str: The AYON entity URI.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=c1># TODO: This is a 1:1 copy from ayon-houdini and may be good to refactor</span>
    <span class=c1>#    and de-duplicate across the codebase, e.g. to core functionality</span>
    <span class=n>project_name</span> <span class=o>=</span> <span class=n>context</span><span class=p>[</span><span class=s2>&quot;project&quot;</span><span class=p>][</span><span class=s2>&quot;name&quot;</span><span class=p>]</span>
    <span class=n>representation_id</span> <span class=o>=</span> <span class=n>context</span><span class=p>[</span><span class=s2>&quot;representation&quot;</span><span class=p>][</span><span class=s2>&quot;id&quot;</span><span class=p>]</span>
    <span class=n>response</span> <span class=o>=</span> <span class=n>ayon_api</span><span class=o>.</span><span class=n>post</span><span class=p>(</span>
        <span class=sa>f</span><span class=s2>&quot;projects/</span><span class=si>{</span><span class=n>project_name</span><span class=si>}</span><span class=s2>/uris&quot;</span><span class=p>,</span>
        <span class=n>entityType</span><span class=o>=</span><span class=s2>&quot;representation&quot;</span><span class=p>,</span>
        <span class=n>ids</span><span class=o>=</span><span class=p>[</span><span class=n>representation_id</span><span class=p>])</span>
    <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>!=</span> <span class=mi>200</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span>
            <span class=sa>f</span><span class=s2>&quot;Unable to resolve AYON entity URI for &#39;</span><span class=si>{</span><span class=n>project_name</span><span class=si>}</span><span class=s2>&#39; &quot;</span>
            <span class=sa>f</span><span class=s2>&quot;representation id &#39;</span><span class=si>{</span><span class=n>representation_id</span><span class=si>}</span><span class=s2>&#39;: </span><span class=si>{</span><span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=si>}</span><span class=s2>&quot;</span>
        <span class=p>)</span>
    <span class=n>uris</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;uris&quot;</span><span class=p>]</span>
    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>uris</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>1</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span>
            <span class=sa>f</span><span class=s2>&quot;Unable to resolve AYON entity URI for &#39;</span><span class=si>{</span><span class=n>project_name</span><span class=si>}</span><span class=s2>&#39; &quot;</span>
            <span class=sa>f</span><span class=s2>&quot;representation id &#39;</span><span class=si>{</span><span class=n>representation_id</span><span class=si>}</span><span class=s2>&#39; to single URI. &quot;</span>
            <span class=sa>f</span><span class=s2>&quot;Received data: </span><span class=si>{</span><span class=n>response</span><span class=o>.</span><span class=n>data</span><span class=si>}</span><span class=s2>&quot;</span>
        <span class=p>)</span>
    <span class=k>return</span> <span class=n>uris</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s2>&quot;uri&quot;</span><span class=p>]</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=client.ayon_maya.api.plugin.get_load_color_for_product_type class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_load_color_for_product_type</span><span class=p>(</span><span class=n>product_type</span><span class=p>,</span> <span class=n>settings</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Get color for product type from settings.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>product_type</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Family name.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>settings</code> </td> <td> <code><span title=Optional>Optional</span>[<span title=dict>dict</span>]</code> </td> <td> <div class=doc-md-description> <p>Settings dictionary.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> </td> <td> <div class=doc-md-description> <p>Union[tuple[float, float, float], None]: RGB color.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_maya/api/plugin.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>637</span>
<span class=normal>638</span>
<span class=normal>639</span>
<span class=normal>640</span>
<span class=normal>641</span>
<span class=normal>642</span>
<span class=normal>643</span>
<span class=normal>644</span>
<span class=normal>645</span>
<span class=normal>646</span>
<span class=normal>647</span>
<span class=normal>648</span>
<span class=normal>649</span>
<span class=normal>650</span>
<span class=normal>651</span>
<span class=normal>652</span>
<span class=normal>653</span>
<span class=normal>654</span>
<span class=normal>655</span>
<span class=normal>656</span>
<span class=normal>657</span>
<span class=normal>658</span>
<span class=normal>659</span>
<span class=normal>660</span>
<span class=normal>661</span>
<span class=normal>662</span>
<span class=normal>663</span>
<span class=normal>664</span>
<span class=normal>665</span>
<span class=normal>666</span>
<span class=normal>667</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_load_color_for_product_type</span><span class=p>(</span><span class=n>product_type</span><span class=p>,</span> <span class=n>settings</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Get color for product type from settings.</span>

<span class=sd>    Args:</span>
<span class=sd>        product_type (str): Family name.</span>
<span class=sd>        settings (Optional[dict]): Settings dictionary.</span>

<span class=sd>    Returns:</span>
<span class=sd>        Union[tuple[float, float, float], None]: RGB color.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=n>settings</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>settings</span> <span class=o>=</span> <span class=n>get_project_settings</span><span class=p>(</span><span class=n>get_current_project_name</span><span class=p>())</span>

    <span class=n>colors</span> <span class=o>=</span> <span class=n>settings</span><span class=p>[</span><span class=s2>&quot;maya&quot;</span><span class=p>][</span><span class=s2>&quot;load&quot;</span><span class=p>][</span><span class=s2>&quot;colors&quot;</span><span class=p>]</span>
    <span class=n>color</span> <span class=o>=</span> <span class=n>colors</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>product_type</span><span class=p>)</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>color</span><span class=p>:</span>
        <span class=k>return</span> <span class=kc>None</span>

    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>color</span><span class=p>)</span> <span class=o>==</span> <span class=mi>3</span><span class=p>:</span>
        <span class=n>red</span><span class=p>,</span> <span class=n>green</span><span class=p>,</span> <span class=n>blue</span> <span class=o>=</span> <span class=n>color</span>
    <span class=k>elif</span> <span class=nb>len</span><span class=p>(</span><span class=n>color</span><span class=p>)</span> <span class=o>==</span> <span class=mi>4</span><span class=p>:</span>
        <span class=n>red</span><span class=p>,</span> <span class=n>green</span><span class=p>,</span> <span class=n>blue</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>color</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Invalid color definition </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>color</span><span class=p>)))</span>

    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>red</span><span class=p>,</span> <span class=nb>int</span><span class=p>):</span>
        <span class=n>red</span> <span class=o>=</span> <span class=n>red</span> <span class=o>/</span> <span class=mf>255.0</span>
        <span class=n>green</span> <span class=o>=</span> <span class=n>green</span> <span class=o>/</span> <span class=mf>255.0</span>
        <span class=n>blue</span> <span class=o>=</span> <span class=n>blue</span> <span class=o>/</span> <span class=mf>255.0</span>
    <span class=k>return</span> <span class=n>red</span><span class=p>,</span> <span class=n>green</span><span class=p>,</span> <span class=n>blue</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=client.ayon_maya.api.plugin.get_reference_node class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_reference_node</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Get the reference node from the container members</p> <details class=deprecated open> <summary>Deprecated</summary> <p>This function was moved and will be removed in 3.16.x.</p> </details> <details class=quote> <summary>Source code in <code>client/ayon_maya/api/plugin.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span>
<span class=normal>56</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_reference_node</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Get the reference node from the container members</span>

<span class=sd>    Deprecated:</span>
<span class=sd>        This function was moved and will be removed in 3.16.x.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>msg</span> <span class=o>=</span> <span class=s2>&quot;Function &#39;get_reference_node&#39; has been moved.&quot;</span>
    <span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
    <span class=n>cmds</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>lib</span><span class=o>.</span><span class=n>get_reference_node</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=client.ayon_maya.api.plugin.get_reference_node_parents class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_reference_node_parents</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <details class=deprecated open> <summary>Deprecated</summary> <p>This function was moved and will be removed in 3.16.x.</p> </details> <details class=quote> <summary>Source code in <code>client/ayon_maya/api/plugin.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>59</span>
<span class=normal>60</span>
<span class=normal>61</span>
<span class=normal>62</span>
<span class=normal>63</span>
<span class=normal>64</span>
<span class=normal>65</span>
<span class=normal>66</span>
<span class=normal>67</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_reference_node_parents</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Deprecated:</span>
<span class=sd>        This function was moved and will be removed in 3.16.x.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>msg</span> <span class=o>=</span> <span class=s2>&quot;Function &#39;get_reference_node_parents&#39; has been moved.&quot;</span>
    <span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
    <span class=n>cmds</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>lib</span><span class=o>.</span><span class=n>get_reference_node_parents</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../../..", "features": ["navigation.sections", "navigation.path", "navigation.prune"], "search": "../../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../../../assets/javascripts/bundle.c8b220af.min.js></script> </body> </html>